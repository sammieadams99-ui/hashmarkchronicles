<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hashmark Chronicles — Kentucky Athletics Blog</title>
  <meta name="description" content="Independent Kentucky football analysis with film-room breakdowns, data-driven previews, and postgame reviews. Hoops coverage coming soon." />
  <link rel="canonical" href="https://hashmarkchronicles.online/" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Hashmark Chronicles — Kentucky Athletics Blog" />
  <meta property="og:description" content="Independent Kentucky football analysis with film-room breakdowns, data-driven previews, and postgame reviews." />
  <meta property="og:image" content="https://artwork.espncdn.com/events/401752743/16x9/1280x720_20250324202019.png" />
  <meta property="og:url" content="https://hashmarkchronicles.online/" />
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@HashmarkCFB" />
  <meta name="twitter:title" content="Hashmark Chronicles — Kentucky Athletics Blog" />
  <meta name="twitter:description" content="Independent Kentucky football analysis with film-room breakdowns, data-driven previews, and postgame reviews." />
  <meta name="twitter:image" content="https://artwork.espncdn.com/events/401752743/16x9/1280x720_20250324202019.png" />

  <!-- Retro font (ticker only) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <!-- Chart.js (you had this already) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="./scripts/spotlight-client.js"></script>

  <style>
    :root{
      --ky-blue:#0033a0; --ink:#0b0d12; --paper:#ffffff; --muted:#eef1f6; --hc-green:#39ff14;
      --accent:#1b75ff; --shadow:0 6px 24px rgba(0,0,0,.12); --radius:18px;
      --good:#16a34a; --bad:#dc2626; --warn:#d97706;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0}
    body{font-family:Georgia,Times,"Times New Roman",serif;color:var(--ink);background:#f7f8fb;line-height:1.6}
    a{color:var(--ky-blue);text-decoration:none} a:hover{color:var(--accent)}

    .bar{background:var(--ink);color:var(--paper);font:500 14px/1.2 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;padding:8px 16px;display:flex;align-items:center;justify-content:center;gap:10px}
    .bar .dot{width:8px;height:8px;border-radius:50%;background:var(--hc-green);display:inline-block}

    header{position:sticky;top:0;z-index:50;backdrop-filter:blur(8px);background:rgba(255,255,255,.85);border-bottom:2px solid var(--muted)}
    .wrap{max-width:1100px;margin:auto;padding:16px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:16px}

    .brand{display:flex;align-items:center;gap:14px}
    .hc-logo{width:56px;height:56px;border-radius:12px;position:relative;overflow:hidden;background:var(--ky-blue);box-shadow:var(--shadow);display:grid;place-items:center}
    .hc-logo span{font:italic 800 28px/1 system-ui,-apple-system,Segoe UI,Arial,sans-serif;color:#fff;letter-spacing:.5px;transform:translateY(3px)}
    .hc-logo::before{content:"";position:absolute;top:8px;left:8px;right:8px;height:5px;border-radius:5px;background:linear-gradient(90deg,transparent 0%,var(--hc-green) 35%,var(--hc-green) 65%,transparent 100%);filter:drop-shadow(0 0 6px rgba(57,255,20,.6));animation:swipe 2.8s ease-in-out infinite;opacity:.95}
    @keyframes swipe{0%{transform:translateX(-120%)}40%{transform:translateX(0)}60%{transform:translateX(0)}100%{transform:translateX(120%)}}
    .brand-title{display:flex;flex-direction:column}
    .brand-title strong{font:800 20px/1.2 "Franklin Gothic Medium","Arial Narrow",Arial,sans-serif;color:var(--ink)}
    .brand-title small{font:600 12px/1.2 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#4a5568;letter-spacing:.5px}

    nav ul{display:flex;gap:18px;list-style:none;margin:0;padding:0}
    nav a{font:600 14px/1 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}

    .chip-x{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid var(--ky-blue);background:#fff;color:var(--ky-blue);font:700 12px/1 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;transition:background .15s,color .15s,border-color .15s}
    .chip-x:hover{background:var(--ky-blue);color:#fff;border-color:var(--ky-blue)}
    .chip-x .x-glyph{font-weight:900;font-size:14px;line-height:1;display:inline-block;transform:translateY(-1px)}

    .ticker{width:100%;background:#fff;color:#0b0d12;border-top:3px solid var(--ky-blue);border-bottom:1px solid var(--muted);overflow:hidden}
    .ticker__track{display:flex;gap:40px;list-style:none;margin:0;padding:6px 0 6px 100%;font-family:'Press Start 2P',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;font-size:11px;line-height:1.1;white-space:nowrap;animation:hc-marquee 28s linear infinite}
    @keyframes hc-marquee{to{transform:translateX(-100%)}}
    .ticker:hover .ticker__track{animation-play-state:paused}
    @media (prefers-reduced-motion:reduce){.ticker__track{animation:none;padding-left:16px}}
    .ticker__track.trend li{display:inline-flex;align-items:baseline;gap:6px}
    .trend-dot{width:7px;height:7px;border-radius:50%}
    .label{color:#0b0d12}
    .trend-value.good{color:#16a34a}.trend-value.bad{color:#dc2626}.trend-value.warn{color:#d97706}
    .trend-dot.good{background:#16a34a}.trend-dot.bad{background:#dc2626}.trend-dot.warn{background:#d97706}

    .hero{max-width:1100px;margin:24px auto;display:grid;grid-template-columns:1.2fr .8fr;gap:24px}
    .card{background:var(--paper);border:1px solid var(--muted);border-radius:var(--radius);box-shadow:var(--shadow)}
    .card .pad{padding:20px}
    .hero .feature img{display:block;width:100%;height:auto;border-top-left-radius:var(--radius);border-top-right-radius:var(--radius)}
    .kicker{font:700 12px/1 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;text-transform:uppercase;letter-spacing:.12em;color:var(--ky-blue)}
    h1,h2,h3{font-family:"Franklin Gothic Medium","Arial Narrow",Arial,sans-serif;color:#0b0d12}
    h1{font-size:32px;margin:8px 0 14px} h2{font-size:22px;margin:0 0 10px} p{margin:0 0 12px}

    .block{padding:16px;border-top:3px solid var(--ky-blue)}
    .stat-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
    .stat{background:#f3f6fb;border:1px solid var(--muted);border-radius:12px;padding:10px}
    .stat b{display:block;font:800 18px/1.1 "Franklin Gothic Medium","Arial Narrow",Arial,sans-serif}
    .stat span{font:600 12px/1.2 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#475569}

    main{max-width:1100px;margin:0 auto 48px;display:grid;grid-template-columns:1fr .38fr;gap:24px}
    article{background:var(--paper);border:1px solid var(--muted);border-radius:var(--radius);box-shadow:var(--shadow)}
    .prose{padding:24px}.prose h2{margin-top:22px}
    .callout{border-left:4px solid var(--hc-green);background:#f4fff2;padding:12px 14px;border-radius:12px;margin:14px 0}

    .article-body h1{font-size:2.2em;border-bottom:2px solid #003087;padding-bottom:.3em;margin-top:.5rem}
    .header-image,.atmosphere-image,.special-teams-image{width:100%;height:auto;margin:1em 0;border-radius:6px;display:block}
    .video-container{position:relative;padding-bottom:56.25%;height:0;overflow:hidden;margin:1em 0;background:#000 url('https://via.placeholder.com/800x450?text=Video+Loading') center/cover}
    .video-container iframe{position:absolute;top:0;left:0;width:100%;height:100%;border:0}
    blockquote.twitter-tweet{margin:1em auto;border-left:4px solid #003087;padding-left:1em}
    .tweet-embed figcaption{color:#444;font-size:.9em;text-align:center;margin-top:.4rem}
    table{width:100%;border-collapse:collapse;margin:1em 0;font-size:.9em}
    th,td{border:1px solid #ddd;padding:.75em;text-align:left}
    th{background:#003087;color:#fff;font-weight:700}
    tr:nth-child(even){background:#f9f9f9}
    .pull-quote{font-size:1.1em;font-style:italic;color:#333;border-left:4px solid #bf5700;padding:.5em 1em;margin:1.5em 0}
    .section-divider{height:2px;background:linear-gradient(to right,#003087,#bf5700);margin:2rem 0}

    .mini-spotlight .row{display:flex;gap:10px;align-items:center;padding:8px;border:1px solid var(--muted);border-radius:10px;background:#fff;margin:8px 0}
    .mini-spotlight .row:hover{background:#f3f6fb}
    .mini-spotlight img{width:48px;height:48px;border-radius:8px;object-fit:cover;border:1px solid var(--muted)}
    .mini-spotlight .who{font:700 14px/1.2 "Franklin Gothic Medium","Arial Narrow",Arial,sans-serif;color:#0b0d12}
    .mini-spotlight .stat{font:600 12px/1.3 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#475569}
    .mini-spotlight .tiny{font:600 11px/1 system-ui;color:#64748b}
    .mini-spotlight .toggles{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0 8px}
    .mini-spotlight .chip{border:1px solid var(--muted);border-radius:999px;padding:6px 10px;background:#fff;font:700 12px/1 system-ui;cursor:pointer}
    .mini-spotlight .chip.active{background:#0033a0;color:#fff;border-color:#0033a0}
    .mini-spotlight .debug-chip{display:inline-flex;align-items:center;gap:6px;margin:8px 0;padding:6px 12px;border-radius:999px;background:var(--muted);color:#0b0d12;font:700 11px/1 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .mini-spotlight .debug-chip .dot{width:8px;height:8px;border-radius:50%;background:#2563eb;display:inline-block}
    .mini-spotlight .tag{margin-top:6px;font:600 11px/1.2 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#64748b;text-transform:uppercase;letter-spacing:.04em}

    #pulse .feeds{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    @media (max-width:980px){#pulse .feeds{grid-template-columns:1fr}}

    footer{background:var(--ink);color:#c7d2fe;padding:28px 0;margin-top:40px}
    footer .cols{max-width:1100px;margin:auto;display:grid;grid-template-columns:1fr 1fr;gap:18px}
    footer a{color:#c7d2fe}

    @media (max-width:980px){
      .hero,main{grid-template-columns:1fr}
      nav ul{flex-wrap:wrap}
      .article-body h1{font-size:1.8em}
    }
  /* --- Mobile Optimization Pack --- */
  :root{--tap:48px}
  .sr-only{position:absolute;left:-10000px;top:auto;width:1px;height:1px;overflow:hidden}
  header{padding-top:env(safe-area-inset-top)}
  .menu-btn{display:none;width:var(--tap);height:var(--tap);border:1px solid var(--muted);background:#fff;border-radius:12px;box-shadow:var(--shadow);align-items:center;justify-content:center}
  .menu-btn .menu-lines{display:block;width:20px;height:2px;background:var(--ink);position:relative}
  .menu-btn .menu-lines::before,.menu-btn .menu-lines::after{content:"";position:absolute;left:0;width:20px;height:2px;background:var(--ink)}
  .menu-btn .menu-lines::before{top:-6px}.menu-btn .menu-lines::after{top:6px}
  @media(max-width:820px){.menu-btn{display:inline-flex}header .row{gap:10px}nav#primaryNav{position:fixed;inset:calc(env(safe-area-inset-top)+56px)0 0 0;background:#fff;border-top:1px solid var(--muted);transform:translateY(-120%);transition:.25s transform ease;z-index:60;padding:16px 20px}nav#primaryNav ul{flex-direction:column;gap:14px}body.nav-open nav#primaryNav{transform:translateY(0)}body.nav-open{overflow:hidden;touch-action:none}}
  @media(max-width:640px){h1{font-size:clamp(22px,6vw,28px)}h2{font-size:clamp(18px,5vw,22px)}.prose{padding:16px}.card .pad{padding:16px}}
  @media(max-width:600px){.hero{gap:14px}main{gap:16px}}
  .ticker{overscroll-behavior:contain}
  @media(max-width:640px){.ticker__track{font-size:10px;gap:24px;animation-duration:38s!important}}
  #pulse .feeds{content-visibility:auto;contain-intrinsic-size:500px}
  .header-image,.atmosphere-image,.special-teams-image{aspect-ratio:16/9;object-fit:cover}
  @media(max-width:640px){a,button{min-height:var(--tap)}.chip,.chip-x{min-height:40px}}
  @media(prefers-reduced-motion:reduce){.ticker__track{animation:none}.hc-logo::before{animation:none}}
  .nav-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.32);backdrop-filter:saturate(120%) blur(2px);opacity:0;pointer-events:none;transition:.2s opacity ease;z-index:59}
  body.nav-open .nav-backdrop{opacity:1;pointer-events:auto}
  nav#primaryNav{z-index:60}
  body.nav-open{overflow:hidden;touch-action:none;overscroll-behavior:contain}
  header{position:sticky;top:0;z-index:70}
  @media (max-width:640px){.hc-debug-badge{position:fixed;right:12px;bottom:12px;z-index:80}}
  </style>
</head>
<body>
  <div class="bar"><span class="dot"></span> Kentucky Football • Independent film-room analysis & previews • HC Hoops returns this winter</div>

  <header>
    <div class="wrap row">
      <div class="brand">
        <div class="hc-logo" aria-label="Hashmark Chronicles logo"><span>HC</span></div>
        <div class="brand-title">
          <strong>Hashmark Chronicles</strong>
          <small>Kentucky Athletics Blog</small>
        </div>
      </div>
      <button id="menuToggle" class="menu-btn" aria-expanded="false" aria-controls="primaryNav">
        <span class="menu-lines" aria-hidden="true"></span><span class="sr-only">Menu</span>
      </button>
      <nav id="primaryNav" aria-label="Primary">
        <ul>
          <li><a href="#article">Gridiron</a></li>
          <li><a href="#hardtop">Hardtop</a></li>
          <li><a href="#pulse">The Pulse</a></li>
          <li><a href="/posts/library.html">Articles</a></li>
          <li><a href="#about">About</a></li>
          <li>
            <a class="chip-x" href="https://x.com/HashmarkCFB" target="_blank" rel="me noopener" aria-label="Follow @HashmarkCFB on X">
              <span class="x-glyph" aria-hidden="true">𝕏</span><span>@HashmarkCFB</span>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </header>

  <div id="navBackdrop" class="nav-backdrop" hidden></div>

  <!-- TICKER -->
  <div class="ticker" aria-label="Season leaders & trending stats">
    <ul class="ticker__track trend" id="tickerTrack">
      <li><span class="trend-dot good"></span><span class="label"><strong>Explosive PA rate</strong> <span class="trend-value good">+6.3%</span> vs base</span></li>
      <li><span class="trend-dot good"></span><span class="label"><strong>Yds/Play (UK)</strong> <span class="trend-value good">5.7</span></span></li>
      <li><span class="trend-dot warn"></span><span class="label"><strong>Havoc Allowed</strong> <span class="trend-value warn">42%</span> steady</span></li>
      <li><span class="trend-dot bad"></span><span class="label"><strong>3rd &amp; 6+ defense</strong> <span class="trend-value bad">46%</span> conv. allowed</span></li>
      <li><span class="trend-dot good"></span><span class="label"><strong>Boley</strong> <span class="trend-value good">885 yds • 4 TD</span></span></li>
    </ul>
  </div>

  <!-- HERO -->
  <section class="hero">
    <article class="card feature" itemscope itemtype="https://schema.org/Article">
      <img src="https://artwork.espncdn.com/events/401752743/16x9/1280x720_20250324202019.png" alt="Texas Longhorns vs Kentucky Wildcats — ESPN event graphic" />
      <div class="pad">
        <div class="kicker">Game Preview</div>
        <h1 itemprop="headline">Kentucky vs. Texas — Oct. 18, 2025</h1>
        <p itemprop="description">Your full preview: atmosphere, QB breakdowns, trench warfare, special teams, and the upset call.</p>
        <p><a href="#article">Read the breakdown →</a></p>
      </div>
    </article>

    <aside class="card">
      <div class="block">
        <div class="kicker">Next Kickoff</div>
        <h2><span id="nextTeamName">Kentucky</span> @ <span id="nextOpponent" style="white-space:nowrap">[Opponent]</span></h2>
        <p id="nextMeta">Date • Time • TV: <b>ESPN</b></p>
        <div class="stat-grid" style="margin-top:10px">
          <div class="stat"><b>5.7</b><span>Yards/Play (UK)</span></div>
          <div class="stat"><b>+0.08</b><span>EPA/Play last 3</span></div>
          <div class="stat"><b>42%</b><span>Havoc Allowed</span></div>
          <div class="stat"><b>58%</b><span>Success Rate (PA)</span></div>
        </div>
      </div>
      <div class="block">
        <div class="kicker">Hashmarks</div>
        <p style="margin:8px 0 12px">Quick-hit trends we’re tracking.</p>
        <ul>
          <li>RPO usage climbing on 2nd-and-medium.</li>
          <li>Boundary corner blitz ~12% vs heavy sets.</li>
          <li>Field-hash shots: +1.2 EPA/play.</li>
        </ul>
      </div>
    </aside>
  </section>

  <!-- MAIN -->
  <main>
    <article id="article" class="article">
      <div class="prose article-body">
        <img src="https://artwork.espncdn.com/events/401752743/16x9/1280x720_20250324202019.png" alt="Texas Longhorns vs Kentucky Wildcats — ESPN event graphic" class="header-image" referrerpolicy="no-referrer">
        <h1>Kentucky vs. Texas Football Preview – Oct. 18, 2025</h1>
        <h2>Opening Context</h2>
        <p>…(your original copy continues)…</p>
      </div>
    </article>

    <aside aria-label="Sidebar">
      <div class="card pad mini-spotlight" id="hc-spotlight-card">
        <div class="kicker">Player Spotlight</div>
        <div id="hc-spotlight-debug" class="debug-chip" aria-live="polite">
          <span class="dot" aria-hidden="true"></span>
          <span class="label">data-mode: init • roster: —</span>
        </div>
        <div id="hc-spotlight" data-spotlight aria-live="polite"></div>
        <div class="tiny">Auto-updating from official stats (falls back if offline).</div>
      </div>

      <div class="card pad">
        <div class="kicker">Newsletter</div>
        <h3>Join the Film Room</h3>
        <p>One email after each game: charts, context, and a clean verdict.</p>
        <form action="#" method="post" onsubmit="alert('Stub — wire this to your email provider'); return false;">
          <label for="email" style="display:block;margin-bottom:6px">Email</label>
          <input id="email" name="email" type="email" required placeholder="you@example.com" style="width:100%;padding:12px;border-radius:10px;border:1px solid var(--muted);margin-bottom:10px" />
          <button type="submit" style="background:var(--ky-blue);color:#fff;border:none;padding:10px 14px;border-radius:10px;font-weight:700">Subscribe</button>
        </form>
      </div>

      <div class="card pad" id="about">
        <div class="kicker">About</div>
        <p>Hashmark Chronicles is an independent Kentucky athletics outlet: film-first, data-backed, and unbothered by press-room groupthink. Football now; hoops soon.</p>
      </div>
    </aside>
  </main>

  <section id="hardtop" class="wrap" style="max-width:1100px;margin:0 auto 32px;">
    <div class="card pad">
      <div class="kicker">Hardtop</div>
      <h2>Basketball coverage returns this winter.</h2>
      <p>We’ll post scouting notes, tempo trends, and shooting gravity maps here.</p>
    </div>
  </section>

  <section id="pulse" class="wrap" style="max-width:1100px;margin:0 auto 40px;">
    <div class="card pad">
      <div class="kicker">The Pulse</div>
      <h2 style="margin-top:6px">Live highlights & Kentucky feeds</h2>
      <p style="margin-bottom:12px">Embedded timelines for quick scrolling. Swap handles or add more as needed.</p>
      <div class="feeds">
        <div><a class="twitter-timeline" data-height="500" data-theme="light" data-chrome="noheader nofooter noborders transparent" href="https://twitter.com/UKFootball">Tweets by UKFootball</a></div>
        <div><a class="twitter-timeline" data-height="500" data-theme="light" data-chrome="noheader nofooter noborders transparent" href="https://twitter.com/UKAthletics">Tweets by UKAthletics</a></div>
        <div><a class="twitter-timeline" data-height="500" data-theme="light" data-chrome="noheader nofooter noborders transparent" href="https://twitter.com/KySportsRadio">Tweets by KySportsRadio</a></div>
      </div>
    </div>
  </section>

  <footer>
    <div class="cols">
      <div>
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
          <div class="hc-logo" aria-hidden="true"><span>HC</span></div>
          <div>
            <strong style="display:block;font:800 16px/1.2 'Franklin Gothic Medium','Arial Narrow',Arial,sans-serif;color:#e2e8f0">Hashmark Chronicles</strong>
            <span style="font:600 12px/1.2 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#94a3b8">Kentucky Athletics Blog</span>
          </div>
        </div>
        <small style="color:#aab4d4">© <span id="year"></span> HC Media. Not affiliated with the University of Kentucky. Opinions are our own.</small>
      </div>
      <div>
        <div class="kicker" style="color:#c7d2fe">Links</div>
        <p><a href="https://twitter.com/HashmarkCFB" target="_blank" rel="noopener">X / Twitter</a> • <a href="#">TikTok</a> • <a href="#">YouTube</a></p>
      </div>
    </div>
  </footer>

  <!-- X/Twitter embeds -->
  <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

  <!-- Single inline script. No /data fetch. Offline-first, then ESPN live. -->
  <script>
  (function start(run){ if(document.readyState!=='loading'){ run(); } else { document.addEventListener('DOMContentLoaded', run); } })(function(){
    (async function(){
      // ---- CONFIG ----
      const TEAM_ID = new URLSearchParams(location.search).get('team') || '96'; // Kentucky default
      const POLL_MS = 30_000;
      const targetSeason = 2025;
      const bust = `?v=${Date.now()}`;
      const INLINE_ENABLED = window.__HC_INLINE__ === true;
      let rosterMeta = null;
      let roster = [];
      let rosterIds = new Set();

      // ---- UTILS ----
      const log = (...a)=>console.log('[HC]',...a);
      const err = (...a)=>console.error('[HC]',...a);
      const headshot = id => id ? `https://a.espncdn.com/i/headshots/college-football/players/full/${id}.png` : '';
      const readInlineJSON = id => {
        if (!INLINE_ENABLED) return null;
        const t=document.getElementById(id);
        if(!t) return null;
        try{return JSON.parse(t.textContent);}catch(e){return null;}
      };

      const featuredEl = document.getElementById('hc-spotlight');
      const spotlightCard = document.getElementById('hc-spotlight-card');
      const spotlightDebug = document.getElementById('hc-spotlight-debug');
      const inlineSpotlightRaw = {
        offense_last: readInlineJSON('fallback-spotlight-offense-last') || [],
        defense_last: readInlineJSON('fallback-spotlight-defense-last') || [],
        offense_season: readInlineJSON('fallback-spotlight-offense-season') || [],
        defense_season: readInlineJSON('fallback-spotlight-defense-season') || []
      };
      const existingInline = window.__HC_SPOTLIGHT_INLINE__ || {};
      window.__HC_SPOTLIGHT_INLINE__ = {
        offense_last: (existingInline.offense_last && existingInline.offense_last.length) ? existingInline.offense_last : inlineSpotlightRaw.offense_last,
        defense_last: (existingInline.defense_last && existingInline.defense_last.length) ? existingInline.defense_last : inlineSpotlightRaw.defense_last,
        offense_season: (existingInline.offense_season && existingInline.offense_season.length) ? existingInline.offense_season : inlineSpotlightRaw.offense_season,
        defense_season: (existingInline.defense_season && existingInline.defense_season.length) ? existingInline.defense_season : inlineSpotlightRaw.defense_season
      };
      const LIVE = window.__HC_SPOTLIGHT_LIVE__ = window.__HC_SPOTLIGHT_LIVE__ || {
        offense_last: [],
        defense_last: [],
        offense_season: [],
        defense_season: []
      };
      let span = 'last';

      function rosterIdFrom(entry){
        if(!entry||typeof entry!=='object') return null;
        const candidates=[entry.id, entry.athleteId, entry.athlete_id, entry.playerId, entry.player_id];
        for(const candidate of candidates){
          const num=Number(candidate);
          if(Number.isFinite(num) && rosterIds.has(num)) return num;
        }
        return null;
      }

      function keepRosterEntry(entry){
        const id=rosterIdFrom(entry);
        if(id==null) return false;
        if(entry && typeof entry==='object' && entry.id==null){
          entry.id=id;
        }
        return true;
      }

      function initialsFromName(name){
        return (name||'')
          .split(/\s+/)
          .filter(Boolean)
          .map(part=>part[0])
          .join('')
          .slice(0,2)
          .toUpperCase() || 'UK';
      }

      function statlineFromSource(entry){
        if(!entry||typeof entry!=='object') return '';
        const source = entry.last_game || entry.lastGame || entry.season || entry.stats || {};
        if(Array.isArray(source)){
          return source.filter(Boolean).slice(0,3).join(' • ');
        }
        const rows = Object.entries(source).map(([k,v])=>{
          if(v==null||v==='') return '';
          if(Array.isArray(v)){
            const txt = v.filter(Boolean).join(' / ');
            return txt?`${k.toUpperCase().replace(/_/g,'-')} ${txt}`:'';
          }
          if(typeof v==='object'){
            const inner = Object.entries(v).map(([sk,sv])=>`${sk}:${sv}`).join(' ');
            return inner?`${k.toUpperCase().replace(/_/g,'-')} ${inner}`:'';
          }
          return `${k.toUpperCase().replace(/_/g,'-')} ${v}`;
        }).filter(Boolean).slice(0,3);
        if(rows.length) return rows.join(' • ');
        if(typeof entry.statline==='string'&&entry.statline.trim()) return entry.statline.trim();
        return '';
      }

      function rowHTML(player){
        if(!player) return '';
        const statline = player.statline || statlineFromSource(player);
        const tags = [];
        if(player.pos) tags.push(player.pos.toUpperCase());
        if(player.jersey!=null) tags.push(`#${player.jersey}`);
        const meta = tags.length?` <span class="tiny">${tags.join(' • ')}</span>`:'';
        const head = player.headshot?`<img src="${player.headshot}" alt="${player.name||'Player'} headshot" style="width:48px;height:48px;border-radius:8px;object-fit:cover;border:1px solid var(--muted);">`:`<div style="width:48px;height:48px;border-radius:8px;display:grid;place-items:center;background:#0033a0;color:#fff;font:800 14px/1 system-ui;border:1px solid var(--muted);">${initialsFromName(player.name)}</div>`;
        const link = player.espn?` <a class="tiny" href="${player.espn}" target="_blank" rel="noopener">ESPN ↗</a>`:'';
        return `<div class="row" data-mode="static-fallback">${head}<div><div class="who">${player.name||'Player'}${meta}</div><div class="stat">${statline||'—'}${link}</div></div></div>`;
      }

      function setSpotlightMode(mode){
        window.__HC_SPOTLIGHT_MODE = mode;
        if(spotlightCard) spotlightCard.setAttribute('data-mode', mode);
        if(spotlightDebug) spotlightDebug.setAttribute('data-mode', mode);
        log('Spotlight mode:', mode);
      }

      function applyFeatured(player){
        if(!featuredEl||!player) return;
        featuredEl.innerHTML = rowHTML(player);
        featuredEl.style.display = 'block';
      }

      function renderList(rows){
        if(!featuredEl) return;
        if(!Array.isArray(rows) || rows.length===0){
          featuredEl.innerHTML = '<div class="row" data-mode="empty"><div><div class="who">Spotlight unavailable</div><div class="stat">Season mismatch — refresh later.</div></div></div>';
          featuredEl.style.display = 'block';
          return;
        }
        featuredEl.innerHTML = rows.map(rowHTML).join('');
        featuredEl.style.display = 'block';
      }

      function applyInlineFallback(){
        const inline = window.__HC_SPOTLIGHT_INLINE__ || inlineSpotlightRaw;
        const adapt = p => ({ ...p, statline: p.statline || statlineFromSource(p) });
        const filter = (rows) => (rows || []).filter(keepRosterEntry).map(adapt);
        LIVE.offense_last = filter(inline.offense_last);
        LIVE.defense_last = filter(inline.defense_last);
        LIVE.offense_season = filter(inline.offense_season);
        LIVE.defense_season = filter(inline.defense_season);
        const first = LIVE.offense_last[0] || LIVE.defense_last[0] || null;
        if(first) applyFeatured(first);
        setSpotlightMode('inline');
      }

      function loadMini(mode){
        const detail = { mode: mode || window.__HC_SPOTLIGHT_MODE || 'inline' };
        document.dispatchEvent(new CustomEvent('hc:spotlight:hydrate', { detail }));
      }

      async function getJSON(url,{timeout=8000}={}) {
        const ctrl=new AbortController();
        const id=setTimeout(()=>ctrl.abort(),timeout);
        const res=await fetch(url,{signal:ctrl.signal,cache:'no-store'});
        clearTimeout(id);
        const ct=res.headers.get('content-type')||'';
        if(!res.ok || !ct.includes('application/json'))
          throw new Error(`Bad response ${res.status} for ${url}`);
        return res.json();
      }

      async function loadStaticSpotlight(){
        try {
          const base='/data';
          const [ol,dl,os,ds]=await Promise.all([
            getJSON(`${base}/spotlight_offense_last.json${bust}`),
            getJSON(`${base}/spotlight_defense_last.json${bust}`),
            getJSON(`${base}/spotlight_offense_season.json${bust}`).catch(()=>[]),
            getJSON(`${base}/spotlight_defense_season.json${bust}`).catch(()=>[])
          ]);
          const adapt=p=>{
            const statline=statlineFromSource(p);
            return {...p,statline};
          };
          const filterRows=(rows)=> (rows||[]).filter(keepRosterEntry).map(adapt);
          LIVE.offense_last=filterRows(ol);
          LIVE.defense_last=filterRows(dl);
          LIVE.offense_season=filterRows(os);
          LIVE.defense_season=filterRows(ds);
          window.__HC_SPOTLIGHT_STATIC__={
            offense_last: LIVE.offense_last,
            defense_last: LIVE.defense_last,
            offense_season: LIVE.offense_season,
            defense_season: LIVE.defense_season
          };
          const first=LIVE.offense_last[0]||LIVE.defense_last[0];
          if(first){ applyFeatured(first); }
          setSpotlightMode('static');
          if(span==='last') loadMini('static');
        } catch(e){
          console.warn('Static spotlight not available',e);
          applyInlineFallback();
        }
      }

      let staticPromise=null;
      function ensureStaticSpotlight(){
        if(!staticPromise){
          staticPromise=loadStaticSpotlight();
          window.__HC_SPOTLIGHT_STATIC_PROMISE=staticPromise;
        }
        return staticPromise;
      }

      async function primeRoster(){
        try{
          rosterMeta = await getJSON(`/data/team/roster_meta.json${bust}`);
        }catch(e){
          rosterMeta = null;
        }
        if(!rosterMeta || Number(rosterMeta.season) !== targetSeason){
          console.warn('Season mismatch — refusing to hydrate spotlight');
          setSpotlightMode('season-blocked');
          renderList([]);
          if(spotlightDebug){
            spotlightDebug.textContent = `data-mode:blocked • season:${rosterMeta?.season ?? 'unknown'} • roster:0`;
          }
          throw new Error('season-mismatch');
        }
        roster = await getJSON(`/data/team/roster.json${bust}`);
        rosterIds = new Set((roster||[]).map(p=>Number(p.id)).filter((id)=>Number.isFinite(id)));
        if(!rosterIds.size){
          throw new Error('roster-empty');
        }
      }

      async function updateDebugBadge(){
        if(!spotlightDebug) return;
        const meta = await getJSON(`/data/meta.json${bust}`).catch(()=>null);
        const mode = meta?.mode || 'unknown';
        const seasonValue = meta?.season ?? rosterMeta?.season ?? 'n/a';
        spotlightDebug.textContent = `data-mode:${mode} • season:${seasonValue} • roster:${rosterIds.size}`;
      }

      async function fetchJSONExternal(url,{timeout=8000}={}){
        const ctrl=new AbortController();
        const id=setTimeout(()=>ctrl.abort(),timeout);
        const res=await fetch(url,{signal:ctrl.signal,cache:'no-store'});
        clearTimeout(id);
        const ct=res.headers.get('content-type')||'';
        if(!res.ok || !ct.includes('application/json')) throw new Error(`Bad response ${res.status} for ${url}`);
        return res.json();
      }

      const OFFENSE_POS = new Set(['QB','RB','WR','TE','FB','HB','TB','SB','OT','OG','C','OL']);

      function keyForPlayer(p){
        if(!p||typeof p!=='object') return '';
        const id=p.athleteId||p.athlete_id||p.id||null;
        if(id!=null) return `id:${id}`;
        const name=(p.name||p.fullName||p.full_name||'').trim();
        if(!name) return '';
        const pos=(p.pos||p.position||'').toUpperCase();
        return `${name.toLowerCase()}|${pos}`;
      }

      function mergeLivePlayers(roster,last){
        const map=new Map();
        const add=(entry)=>{
          const key=keyForPlayer(entry);
          if(!key) return;
          const prev=map.get(key)||{ name:'', pos:'', jersey:null, headshot:'', espn:'', season:null, last_game:null, side:'offense', athleteId:null };
          if(entry.name) prev.name=entry.name;
          if(entry.pos||entry.position) prev.pos=(entry.pos||entry.position).toUpperCase();
          if(entry.jersey!=null) prev.jersey=entry.jersey;
          if(entry.headshot) prev.headshot=entry.headshot;
          if(entry.espn||entry.url||entry.link) prev.espn=entry.espn||entry.url||entry.link;
          if(entry.season) prev.season=entry.season;
          if(entry.lastGame||entry.last_game) prev.last_game=entry.lastGame||entry.last_game;
          if(entry.side) prev.side=(entry.side||'offense').toLowerCase();
          if(entry.athleteId!=null) prev.athleteId=entry.athleteId;
          map.set(key,prev);
        };
        roster.forEach(add);
        last.forEach(add);
        return Array.from(map.values()).filter(p=>p.name);
      }

      async function loadLiveSpotlightFromESPN(teamId){
        const rosterData=await fetchJSONExternal(`https://site.api.espn.com/apis/site/v2/sports/football/college-football/teams/${teamId}`);
        const athletes=(rosterData?.team?.athletes||[]).flatMap(g=>g.items||[]);
        const roster=athletes.map(a=>({
          athleteId: a.id?Number(a.id):null,
          name: a.displayName||a.fullName||'',
          pos: (a.position?.abbreviation||a.position?.name||'').toUpperCase(),
          jersey: a.jersey?Number(a.jersey):null,
          headshot: a.headshot?.href||a.links?.headshot?.href||'',
          espn: (Array.isArray(a.links)?a.links.find(l=>Array.isArray(l.rel)?l.rel.includes('playercard'):false)?.href:null) || a.links?.web?.href || '',
          side: OFFENSE_POS.has((a.position?.abbreviation||'').toUpperCase())?'offense':'defense'
        }));

        const sched=await fetchJSONExternal(`https://site.api.espn.com/apis/site/v2/sports/football/college-football/teams/${teamId}/schedule`).catch(()=>({}));
        const events=(sched?.events||[]).filter(e=>e.status?.type?.completed);
        let last=[];
        if(events.length){
          const latest=events.sort((a,b)=>new Date(b.date)-new Date(a.date))[0];
          if(latest?.id){
            try{
              const box=await fetchJSONExternal(`https://site.api.espn.com/apis/site/v2/sports/football/college-football/boxscore?event=${latest.id}`);
              const teams=box?.boxscore?.players||[];
              const ours=teams.find(t=>String(t.team?.id)===String(teamId));
              if(ours){
                const seen=new Map();
                for(const stat of ours.statistics||[]){
                  const groupName=stat.name||'';
                  const isDefense=/defense/i.test(groupName);
                  for(const athlete of stat.athletes||[]){
                    const key=keyForPlayer({ athleteId: athlete.id, name: athlete.athlete?.fullName || athlete.athlete?.displayName || athlete.name, pos: athlete.athlete?.position?.abbreviation || athlete.position });
                    if(!key) continue;
                    const prev=seen.get(key)||{ athleteId: athlete.id?Number(athlete.id):null, name: athlete.athlete?.fullName || athlete.athlete?.displayName || athlete.name || '', pos: (athlete.athlete?.position?.abbreviation || athlete.position || '').toUpperCase(), side: isDefense?'defense':'offense', lastGame:{} };
                    prev.side=isDefense?'defense':prev.side;
                    prev.lastGame[groupName]=athlete.stats||athlete.statLine||athlete;
                    seen.set(key,prev);
                  }
                }
                last=Array.from(seen.values());
              }
            }catch(e){
              console.warn('ESPN boxscore fetch failed',e);
            }
          }
        }

        if(!roster.length && !last.length) throw new Error('ESPN roster empty');

        const merged=mergeLivePlayers(roster,last);
        if(!merged.length) throw new Error('No spotlight entries merged');

        const offSeason=merged.filter(p=>OFFENSE_POS.has((p.pos||'').toUpperCase()));
        const defSeason=merged.filter(p=>!OFFENSE_POS.has((p.pos||'').toUpperCase()));
        const offLast=last.length?mergeLivePlayers([], last.filter(p=>(p.side||'offense').toLowerCase()==='offense')):offSeason;
        const defLast=last.length?mergeLivePlayers([], last.filter(p=>(p.side||'defense').toLowerCase()==='defense')):defSeason;
        const filterLiveRows=(rows)=>{
          const out=[];
          for(const row of rows||[]){
            const clone={...row};
            if(!keepRosterEntry(clone)) continue;
            clone.statline=statlineFromSource(clone);
            out.push(clone);
          }
          return out;
        };
        const seasonOffRows=filterLiveRows(offSeason);
        const seasonDefRows=filterLiveRows(defSeason);
        const lastOffRows=filterLiveRows(offLast.length?offLast:offSeason);
        const lastDefRows=filterLiveRows(defLast.length?defLast:defSeason);
        LIVE.offense_last=lastOffRows;
        LIVE.defense_last=lastDefRows;
        LIVE.offense_season=seasonOffRows;
        LIVE.defense_season=seasonDefRows;
        window.__HC_SPOTLIGHT_LIVE__={
          offense_last: LIVE.offense_last,
          defense_last: LIVE.defense_last,
          offense_season: LIVE.offense_season,
          defense_season: LIVE.defense_season
        };
        const first=LIVE.offense_last[0]||LIVE.defense_last[0];
        if(first) applyFeatured(first);
        setSpotlightMode('live');
        loadMini('live');
      }

      async function j(url){
        const res = await fetch(url,{mode:'cors',cache:'no-store'});
        if(!res.ok) throw new Error(res.status+' '+url);
        return res.json();
      }

      function opponentFromComp(comp, teamId){
        const comps = comp?.competitors||[];
        const foe = comps.find(c=>String(c.team?.id)!==String(teamId))||comps[0];
        return foe?.team?.displayName||'TBA';
      }

      function fmtKick(dateStr, networks){
        const d=new Date(dateStr);
        const when=isFinite(d)?d.toLocaleString(undefined,{weekday:'short',month:'short',day:'numeric',hour:'numeric',minute:'2-digit'}):'TBA';
        const tv=(networks&&networks[0])?(networks[0].shortName||networks[0].name||'TV TBA'):'TV TBA';
        return {when,tv};
      }

      function setKickoffUI(teamName, oppName, meta){
        const t=document.getElementById('nextTeamName');
        const o=document.getElementById('nextOpponent');
        const m=document.getElementById('nextMeta');
        if(t) t.textContent=teamName||'Kentucky';
        if(o) o.textContent=oppName||'[Opponent]';
        if(m) m.innerHTML=`Date • Time • TV: <b>${meta.when}</b> • <b>${meta.tv}</b>`;
      }

      // ---- ESPN DISCOVERY ----
      async function getTeamEnv(teamId){
        try{ return await j(`https://site.api.espn.com/apis/site/v2/sports/football/college-football/teams/${teamId}`); }
        catch(e){ err('team envelope failed',e); return null; }
      }
      async function getSummary(eventId){
        return await j(`https://site.api.espn.com/apis/site/v2/sports/football/college-football/summary?event=${eventId}`);
      }
      async function chooseEvent(env){
        const next=env?.team?.nextEvent?.[0];
        const prev=env?.team?.previousEvent?.[0];

        if(next?.id){
          try{
            const sum=await getSummary(next.id);
            const state=sum?.header?.competitions?.[0]?.status?.type?.state; // pre|in|post
            if(state==='in'||state==='post'){ return {id:next.id,sum,state}; }
            if(prev?.id){
              const sump=await getSummary(prev.id);
              const sp=sump?.header?.competitions?.[0]?.status?.type?.state;
              return {id:prev.id,sum:sump,state:sp,usePrev:true,nextId:next.id};
            }
            return {id:next.id,sum,state};
          }catch(e){ err('next summary failed',e); }
        }
        if(prev?.id){
          try{
            const sump=await getSummary(prev.id);
            const sp=sump?.header?.competitions?.[0]?.status?.type?.state;
            return {id:prev.id,sum:sump,state:sp,usePrev:true};
          }catch(e){ err('prev summary failed',e); }
        }
        return null;
      }

      async function bootLive(){
        const env=await getTeamEnv(TEAM_ID);
        if(!env) throw new Error('team envelope missing');
        const teamName=env?.team?.displayName||'Kentucky';
        let opponent='[Opponent]';
        let meta={ when:'TBA', tv:'TV TBA' };
        const picked=await chooseEvent(env);
        const comp=picked?.sum?.header?.competitions?.[0];
        if(comp){
          opponent=opponentFromComp(comp, TEAM_ID);
          meta=fmtKick(comp?.date, comp?.broadcasts);
        }
        setKickoffUI(teamName, opponent, meta);

        await loadLiveSpotlightFromESPN(TEAM_ID);
      }

      try{
        await primeRoster();
      }catch(err){
        console.warn('primeRoster halted spotlight hydration',err?.message||err);
        return;
      }

      await updateDebugBadge();

      await ensureStaticSpotlight();
      try {
        await bootLive();
      } catch(e) {
        console.warn('bootLive failed; using static/inline', e);
        if(!window.__HC_SPOTLIGHT_MODE) applyInlineFallback();
        loadMini();
      }
      setInterval(async()=>{
        try{ await bootLive(); }
        catch(err){ console.warn('bootLive poll failed', err); }
      }, POLL_MS);

      // ---- TICKER: inline only ----
      (function(){
        const items=readInlineJSON('fallback-ticker');
        const track=document.getElementById('tickerTrack');
        if(Array.isArray(items)&&track){
          track.innerHTML=items.map(it=>{
            const trend=it.trend||'warn';
            const suffix=it.suffix?(' '+it.suffix):'';
            return `<li><span class="trend-dot ${trend}" aria-hidden="true"></span><span class="label"><strong>${it.label}</strong> <span class="trend-value ${trend}">${it.value}</span>${suffix}</span></li>`;
          }).join('');
        }
      })();

      // Footer year
      const y=document.getElementById('year'); if(y) y.textContent=new Date().getFullYear();
    })();
  });
  </script>

  <div id="hc-roster-list" style="max-width:900px;margin:20px auto;display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px"></div>

  <div id="hc-debug" style="position:fixed; bottom:8px; right:8px; background:#111; color:#0f0; font:12px/1.4 monospace; padding:8px 10px; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,.3); z-index:9999"></div>

  <script>
  (async function () {
    const box = document.getElementById('hc-debug');
    if (!box) return;
    const bust = '?v=' + Date.now();
    const url = './data/team/roster.json' + bust;
    try {
      const res = await fetch(url, { cache: 'no-store' });
      box.textContent = 'roster.json → HTTP ' + res.status;
      if (!res.ok) return;
      const roster = await res.json();
      const count = Array.isArray(roster) ? roster.length : 0;
      box.textContent += ' | players: ' + count;
      window.__HC_ROSTER__ = roster;
    } catch (e) {
      box.textContent = 'Fetch failed: ' + (e && e.message ? e.message : e);
    }
  })();
  </script>

  <script>
  (function draw(){
    const roster = window.__HC_ROSTER__;
    if (!Array.isArray(roster)) return setTimeout(draw, 300);
    const root = document.getElementById('hc-roster-list');
    if (!root) return;
    root.innerHTML = roster.map(p => {
      const img = p.headshot ? '<img src="'+p.headshot+'" onerror="this.style.display=\\'none\\'" style="width:48px;height:48px;border-radius:50%;object-fit:cover;margin-right:8px;">' : '';
      const name = (p.name || ((p.firstName||'') + ' ' + (p.lastName||'')).trim()) || 'Unknown';
      const pos = p.position || '';
      const jersey = p.jersey ? (' #' + p.jersey) : '';
      return '<div style="display:flex;align-items:center;background:#fff;border:1px solid #eee;border-radius:10px;padding:10px;">'+img+'<div><strong>'+name+'</strong><div style="opacity:.7">'+pos+jersey+'</div></div></div>';
    }).join('');
  })();
  </script>
  <script>
  (function(){
    const btn=document.getElementById('menuToggle');
    const nav=document.getElementById('primaryNav');
    const backdrop=document.getElementById('navBackdrop');
    if(!btn||!nav||!backdrop)return;
    function openNav(){
      document.body.classList.add('nav-open');
      btn.setAttribute('aria-expanded','true');
      backdrop.hidden=false;
      const focusables=nav.querySelectorAll('a,button,[tabindex]:not([tabindex="-1"])');
      if(focusables.length){focusables[0].focus();}
      document.addEventListener('keydown',onKey);
    }
    function closeNav(){
      document.body.classList.remove('nav-open');
      btn.setAttribute('aria-expanded','false');
      backdrop.hidden=true;
      document.removeEventListener('keydown',onKey);
      btn.focus();
    }
    function onKey(e){if(e.key==='Escape')closeNav();}
    btn.addEventListener('click',()=>document.body.classList.contains('nav-open')?closeNav():openNav());
    backdrop.addEventListener('click',closeNav);
    nav.addEventListener('click',e=>{if(e.target.closest('a'))closeNav();});
    window.addEventListener('scroll',()=>{if(document.body.classList.contains('nav-open'))closeNav();},{passive:true});
  })();
  </script>
</body>
</html>
