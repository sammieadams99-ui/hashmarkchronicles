<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hashmark Chronicles — Kentucky Athletics Review</title>
  <meta name="description" content="Independent Kentucky football analysis with film-room breakdowns, data-driven previews, and postgame reviews. Hoops coverage coming soon." />
  <link rel="canonical" href="https://hashmarkchronicles.online/" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Hashmark Chronicles — Kentucky Athletics Review" />
  <meta property="og:description" content="Independent Kentucky football analysis with film-room breakdowns, data-driven previews, and postgame reviews." />
  <meta property="og:image" content="https://artwork.espncdn.com/events/401752743/16x9/1280x720_20250324202019.png" />
  <meta property="og:url" content="https://hashmarkchronicles.online/" />
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@HashmarkCFB" />
  <meta name="twitter:title" content="Hashmark Chronicles — Kentucky Athletics Blog" />
  <meta name="twitter:description" content="Independent Kentucky football analysis with film-room breakdowns, data-driven previews, and postgame reviews." />
  <meta name="twitter:image" content="https://artwork.espncdn.com/events/401752743/16x9/1280x720_20250324202019.png" />

  <!-- GA4: keep your existing tag here -->

  <!-- Retro font (ticker only) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <!-- Chart.js for any article charts you use -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --ky-blue:#0033a0;
      --ink:#0b0d12;
      --paper:#ffffff;
      --muted:#eef1f6;
      --hc-green:#39ff14;
      --accent:#1b75ff;
      --shadow:0 6px 24px rgba(0,0,0,.12);
      --radius:18px;

      /* trend colors */
      --good:#16a34a;
      --bad:#dc2626;
      --warn:#d97706;
    }

    *{box-sizing:border-box}
    html,body{margin:0;padding:0}
    body{
      font-family: Georgia, Times, "Times New Roman", serif;
      color: var(--ink);
      background: #f7f8fb;
      line-height: 1.6;
    }
    a{color:var(--ky-blue); text-decoration:none}
    a:hover{color:var(--accent)}

    /* Top announcement bar */
    .bar{
      background: var(--ink);
      color: var(--paper);
      font: 500 14px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      padding: 8px 16px;
      display:flex;align-items:center;justify-content:center;gap:10px;
    }
    .bar .dot{width:8px;height:8px;border-radius:50%;background:var(--hc-green);display:inline-block}

    /* Header */
    header{
      position: sticky; top:0; z-index:50;
      backdrop-filter: blur(8px);
      background: rgba(255,255,255,.85);
      border-bottom: 2px solid var(--muted);
    }
    .wrap{max-width:1100px;margin:auto;padding:16px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:16px}

    /* Brand + logo */
    .brand{display:flex;align-items:center;gap:14px}
    .hc-logo{
      width:56px;height:56px; border-radius:12px; position:relative; overflow:hidden;
      background: var(--ky-blue);
      box-shadow: var(--shadow);
      display:grid; place-items:center;
    }
    .hc-logo span{
      font: italic 800 28px/1 system-ui, -apple-system, Segoe UI, Arial, sans-serif;
      color:#fff; letter-spacing:.5px; transform: translateY(3px);
    }
    .hc-logo::before{
      content:""; position:absolute; top:8px; left:8px; right:8px; height:5px; border-radius:5px;
      background: linear-gradient(90deg, transparent 0%, var(--hc-green) 35%, var(--hc-green) 65%, transparent 100%);
      filter: drop-shadow(0 0 6px rgba(57,255,20,.6)); animation: swipe 2.8s ease-in-out infinite; opacity:.95;
    }
    @keyframes swipe { 0%{transform:translateX(-120%)} 40%{transform:translateX(0)} 60%{transform:translateX(0)} 100%{transform:translateX(120%)} }
    .brand-title{display:flex;flex-direction:column}
    .brand-title strong{font: 800 20px/1.2 "Franklin Gothic Medium","Arial Narrow",Arial,sans-serif; color: var(--ink)}
    .brand-title small{font: 600 12px/1.2 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#4a5568; letter-spacing:.5px}

    nav ul{display:flex;gap:18px;list-style:none;margin:0;padding:0}
    nav a{font:600 14px/1 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}

    /* X chip in nav */
    .chip-x{
      display:inline-flex; align-items:center; gap:6px;
      padding:6px 10px; border-radius:999px;
      border:1px solid var(--ky-blue); background:#fff; color:var(--ky-blue);
      font:700 12px/1 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      transition:background .15s ease,color .15s ease,border-color .15s ease;
    }
    .chip-x:hover{ background:var(--ky-blue); color:#fff; border-color:var(--ky-blue); text-decoration:none }
    .chip-x .x-glyph{ font-weight:900; font-size:14px; line-height:1; display:inline-block; transform: translateY(-1px); }

    /* Ticker — slim; only numbers colored; retro font */
    .ticker{
      width:100%; background:#ffffff; color:#0b0d12;
      border-top:3px solid var(--ky-blue); border-bottom:1px solid var(--muted); overflow:hidden;
    }
    .ticker__track{
      display:flex; gap:40px; list-style:none; margin:0; padding:6px 0 6px 100%;
      font-family:'Press Start 2P', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-size:11px; line-height:1.1; white-space:nowrap; animation:hc-marquee 28s linear infinite;
    }
    @keyframes hc-marquee{ to { transform: translateX(-100%); } }
    .ticker:hover .ticker__track{ animation-play-state: paused; }
    @media (prefers-reduced-motion: reduce){ .ticker__track{ animation:none; padding-left:16px; } }
    .ticker__track.trend li{ display:inline-flex; align-items:baseline; gap:6px; padding:0; border:0; background:transparent; }
    .trend-dot{width:7px;height:7px;border-radius:50%}
    .label{color:#0b0d12}
    .trend-value.good{ color:#16a34a } .trend-value.bad{ color:#dc2626 } .trend-value.warn{ color:#d97706 }
    .trend-dot.good{ background:#16a34a } .trend-dot.bad{ background:#dc2626 } .trend-dot.warn{ background:#d97706 }

    /* Hero */
    .hero{max-width:1100px;margin:24px auto;display:grid;grid-template-columns: 1.2fr .8fr;gap:24px}
    .card{background:var(--paper); border:1px solid var(--muted); border-radius: var(--radius); box-shadow: var(--shadow)}
    .card .pad{padding:20px}
    .hero .feature img{display:block;width:100%;height:auto;border-top-left-radius:var(--radius);border-top-right-radius:var(--radius)}
    .kicker{font:700 12px/1 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;text-transform:uppercase;letter-spacing:.12em;color:var(--ky-blue)}
    h1,h2,h3{font-family:"Franklin Gothic Medium","Arial Narrow",Arial,sans-serif;color:#0b0d12}
    h1{font-size:32px;margin:8px 0 14px}
    h2{font-size:22px;margin:0 0 10px}
    p{margin:0 0 12px}

    /* Sidebar blocks */
    .block{padding:16px;border-top:3px solid var(--ky-blue)}
    .stat-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
    .stat{background:#f3f6fb;border:1px solid var(--muted);border-radius:12px;padding:10px}
    .stat b{display:block;font:800 18px/1.1 "Franklin Gothic Medium","Arial Narrow",Arial,sans-serif}
    .stat span{font:600 12px/1.2 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#475569}

    /* Main layout */
    main{max-width:1100px;margin:0 auto 48px;display:grid;grid-template-columns:1fr .38fr;gap:24px}
    article{background:var(--paper);border:1px solid var(--muted);border-radius:var(--radius);box-shadow:var(--shadow)}
    .prose{padding:24px}
    .prose h2{margin-top:22px}
    .callout{border-left:4px solid var(--hc-green); background:#f4fff2; padding:12px 14px; border-radius:12px; margin:14px 0}

    /* Article specifics */
    .article-body h1{ font-size: 2.2em; border-bottom: 2px solid #003087; padding-bottom: .3em; margin-top: .5rem; }
    .header-image,.atmosphere-image,.special-teams-image{width:100%;height:auto;margin:1em 0;border-radius:6px;display:block}
    .video-container{position:relative;padding-bottom:56.25%;height:0;overflow:hidden;margin:1em 0;background:#000 url('https://via.placeholder.com/800x450?text=Video+Loading') center/cover}
    .video-container iframe{position:absolute;top:0;left:0;width:100%;height:100%;border:0}
    blockquote.twitter-tweet{margin:1em auto;border-left:4px solid #003087;padding-left:1em}
    .tweet-embed figcaption{color:#444;font-size:.9em;text-align:center;margin-top:.4rem}
    table{width:100%;border-collapse:collapse;margin:1em 0;font-size:.9em}
    th,td{border:1px solid #ddd;padding:.75em;text-align:left}
    th{background:#003087;color:#fff;font-weight:700}
    tr:nth-child(even){background:#f9f9f9}
    .pull-quote{font-size:1.1em;font-style:italic;color:#333;border-left:4px solid #bf5700;padding:.5em 1em;margin:1.5em 0}
    .section-divider{height:2px;background:linear-gradient(to right,#003087,#bf5700);margin:2rem 0}

    /* Mini Spotlight (sidebar rectangles) */
    .mini-spotlight .row {
      display:flex; gap:10px; align-items:center; padding:8px; border:1px solid var(--muted);
      border-radius:10px; background:#fff; margin:8px 0;
    }
    .mini-spotlight .row:hover { background:#f3f6fb; }
    .mini-spotlight img { width:48px; height:48px; border-radius:8px; object-fit:cover; border:1px solid var(--muted) }
    .mini-spotlight .who { font:700 14px/1.2 "Franklin Gothic Medium","Arial Narrow",Arial,sans-serif; color:#0b0d12 }
    .mini-spotlight .stat { font:600 12px/1.3 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; color:#475569 }
    .mini-spotlight .tiny { font:600 11px/1 system-ui; color:#64748b }
    .mini-spotlight .toggles { display:flex; gap:8px; flex-wrap:wrap; margin:6px 0 8px }
    .mini-spotlight .chip {
      border:1px solid var(--muted); border-radius:999px; padding:6px 10px; background:#fff;
      font:700 12px/1 system-ui; cursor:pointer;
    }
    .mini-spotlight .chip.active { background:#0033a0; color:#fff; border-color:#0033a0 }

    /* Pulse */
    #pulse .feeds{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    @media (max-width: 980px){ #pulse .feeds{grid-template-columns:1fr} }

    /* Footer */
    footer{background:var(--ink);color:#c7d2fe;padding:28px 0;margin-top:40px}
    footer .cols{max-width:1100px;margin:auto;display:grid;grid-template-columns:1fr 1fr;gap:18px}
    footer a{color:#c7d2fe}

    /* Responsive */
    @media (max-width: 980px){
      .hero, main{grid-template-columns:1fr}
      nav ul{flex-wrap:wrap}
      .article-body h1{font-size:1.8em}
    }
  </style>
</head>
<body>
  <div class="bar"><span class="dot"></span> Kentucky Football • Independent film-room analysis & previews • HC Hoops returns this winter</div>

  <header>
    <div class="wrap row">
      <div class="brand">
        <div class="hc-logo" aria-label="Hashmark Chronicles logo"><span>HC</span></div>
        <div class="brand-title">
          <strong>Hashmark Chronicles</strong>
          <small>Kentucky Athletics Review</small>
        </div>
      </div>
      <nav aria-label="Primary">
        <ul>
          <li><a href="#article">Gridiron</a></li>
          <li><a href="#hardtop">Hardtop</a></li>
          <li><a href="#pulse">The Pulse</a></li>
          <li><a href="/posts/library.html">Articles</a></li>
          <li><a href="#about">About</a></li>
          <li>
            <a class="chip-x" href="https://x.com/HashmarkCFB" target="_blank" rel="me noopener"
               aria-label="Follow @HashmarkCFB on X">
              <span class="x-glyph" aria-hidden="true">𝕏</span>
              <span>@HashmarkCFB</span>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- TICKER -->
  <div class="ticker" aria-label="Season leaders & trending stats">
    <ul class="ticker__track trend" id="tickerTrack">
      <!-- Fallback text remains until JSON or inline fallback loads -->
      <li><span class="trend-dot good"></span><span class="label"><strong>Explosive PA rate</strong> <span class="trend-value good">+6.3%</span> vs base</span></li>
      <li><span class="trend-dot good"></span><span class="label"><strong>Yds/Play (UK)</strong> <span class="trend-value good">5.7</span></span></li>
      <li><span class="trend-dot warn"></span><span class="label"><strong>Havoc Allowed</strong> <span class="trend-value warn">42%</span> steady</span></li>
      <li><span class="trend-dot bad"></span><span class="label"><strong>3rd &amp; 6+ defense</strong> <span class="trend-value bad">46%</span> conv. allowed</span></li>
      <li><span class="trend-dot good"></span><span class="label"><strong>Boley</strong> <span class="trend-value good">885 yds • 4 TD</span></span></li>
    </ul>
  </div>

  <!-- HERO -->
  <section class="hero">
    <article class="card feature" itemscope itemtype="https://schema.org/Article">
      <img src="https://artwork.espncdn.com/events/401752743/16x9/1280x720_20250324202019.png" alt="Texas Longhorns vs Kentucky Wildcats — ESPN event graphic" />
      <div class="pad">
        <div class="kicker">Game Preview</div>
        <h1 itemprop="headline">Kentucky vs. Texas — Oct. 18, 2025</h1>
        <p itemprop="description">Your full preview: atmosphere, QB breakdowns, trench warfare, special teams, and the upset call.</p>
        <p><a href="#article">Read the breakdown →</a></p>
      </div>
    </article>

    <aside class="card">
      <div class="block">
        <div class="kicker">Next Kickoff</div>
        <!-- IDs added for live fill-in; same visual structure -->
        <h2><span id="nextTeamName">Kentucky</span> @ <span id="nextOpponent" style="white-space:nowrap">[Opponent]</span></h2>
        <p id="nextMeta">Date • Time • TV: <b>ESPN</b></p>
        <div class="stat-grid" style="margin-top:10px">
          <div class="stat"><b>5.7</b><span>Yards/Play (UK)</span></div>
          <div class="stat"><b>+0.08</b><span>EPA/Play last 3</span></div>
          <div class="stat"><b>42%</b><span>Havoc Allowed</span></div>
          <div class="stat"><b>58%</b><span>Success Rate (PA)</span></div>
        </div>
      </div>
      <div class="block">
        <div class="kicker">Hashmarks</div>
        <p style="margin:8px 0 12px">Quick-hit trends we’re tracking.</p>
        <ul>
          <li>RPO usage climbing on 2nd-and-medium.</li>
          <li>Boundary corner blitz ~12% vs heavy sets.</li>
          <li>Field-hash shots: +1.2 EPA/play.</li>
        </ul>
      </div>
    </aside>
  </section>

  <!-- MAIN -->
  <main>
    <article id="article" class="article">
      <div class="prose article-body">

        <!-- Your existing article content goes here (kept intact). Example header image + title: -->
        <img
          src="https://artwork.espncdn.com/events/401752743/16x9/1280x720_20250324202019.png"
          alt="Texas Longhorns vs Kentucky Wildcats — ESPN event graphic"
          class="header-image"
          referrerpolicy="no-referrer">

        <h1>Kentucky vs. Texas Football Preview – Oct. 18, 2025</h1>

        <h2>Opening Context</h2>
        <p>…(your original copy continues)…</p>

        <!-- Keep your embeds, charts, sections, etc., unchanged -->

      </div>
    </article>

    <aside aria-label="Sidebar">
      <!-- Player Spotlight (compact rectangles) -->
      <div class="card pad mini-spotlight" id="miniSpotlight">
        <div class="kicker">Player Spotlight</div>

        <!-- Featured (auto one): -->
        <div id="miniFeatured" class="row" style="display:none"></div>

        <!-- Toggles -->
        <div class="toggles">
          <button class="chip" data-side="offense">Offense</button>
          <button class="chip" data-side="defense">Defense</button>
          <button class="chip" data-span="last">Last</button>
          <button class="chip" data-span="season">Season</button>
        </div>

        <!-- List -->
        <div id="miniList"></div>
        <div class="tiny">Auto-updating from official stats (falls back if offline).</div>
      </div>

      <!-- Newsletter -->
      <div class="card pad">
        <div class="kicker">Newsletter</div>
        <h3>Join the Film Room</h3>
        <p>One email after each game: charts, context, and a clean verdict.</p>
        <form action="#" method="post" onsubmit="alert('Stub — wire this to your email provider'); return false;">
          <label for="email" style="display:block;margin-bottom:6px">Email</label>
          <input id="email" name="email" type="email" required placeholder="you@example.com" style="width:100%;padding:12px;border-radius:10px;border:1px solid var(--muted);margin-bottom:10px" />
          <button type="submit" style="background:var(--ky-blue);color:#fff;border:none;padding:10px 14px;border-radius:10px;font-weight:700">Subscribe</button>
        </form>
      </div>

      <!-- About -->
      <div class="card pad" id="about">
        <div class="kicker">About</div>
        <p>Hashmark Chronicles is an independent Kentucky athletics outlet: film-first, data-backed, and unbothered by press-room groupthink. Football now; hoops soon.</p>
      </div>
    </aside>
  </main>

  <!-- Hardtop anchor (placeholder) -->
  <section id="hardtop" class="wrap" style="max-width:1100px;margin:0 auto 32px;">
    <div class="card pad">
      <div class="kicker">Hardtop</div>
      <h2>Basketball coverage returns this winter.</h2>
      <p>We’ll post scouting notes, tempo trends, and shooting gravity maps here.</p>
    </div>
  </section>

  <!-- The Pulse -->
  <section id="pulse" class="wrap" style="max-width:1100px;margin:0 auto 40px;">
    <div class="card pad">
      <div class="kicker">The Pulse</div>
      <h2 style="margin-top:6px">Live highlights & Kentucky feeds</h2>
      <p style="margin-bottom:12px">Embedded timelines for quick scrolling. Swap handles or add more as needed.</p>
      <div class="feeds">
        <div><a class="twitter-timeline" data-height="500" data-theme="light" data-chrome="noheader nofooter noborders transparent" href="https://twitter.com/UKFootball">Tweets by UKFootball</a></div>
        <div><a class="twitter-timeline" data-height="500" data-theme="light" data-chrome="noheader nofooter noborders transparent" href="https://twitter.com/UKAthletics">Tweets by UKAthletics</a></div>
        <div><a class="twitter-timeline" data-height="500" data-theme="light" data-chrome="noheader nofooter noborders transparent" href="https://twitter.com/KySportsRadio">Tweets by KySportsRadio</a></div>
      </div>
    </div>
  </section>

  <footer>
    <div class="cols">
      <div>
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
          <div class="hc-logo" aria-hidden="true"><span>HC</span></div>
          <div>
            <strong style="display:block;font:800 16px/1.2 'Franklin Gothic Medium','Arial Narrow',Arial,sans-serif; color:#e2e8f0">Hashmark Chronicles</strong>
            <span style="font:600 12px/1.2 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; color:#94a3b8">Kentucky Athletics Review</span>
          </div>
        </div>
        <small style="color:#aab4d4">© <span id="year"></span> HC Media. Not affiliated with the University of Kentucky. Opinions are our own.</small>
      </div>
      <div>
        <div class="kicker" style="color:#c7d2fe">Links</div>
        <p><a href="https://twitter.com/HashmarkChron" target="_blank" rel="noopener">X / Twitter</a> • <a href="#">TikTok</a> • <a href="#">YouTube</a></p>
      </div>
    </div>
  </footer>

  <!-- X/Twitter embeds -->
  <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

  <!-- ======== INLINE FALLBACK DATA (used only if /data/*.json not present or ESPN unavailable) ======== -->
  <script type="application/json" id="fallback-ticker">
  [
    { "label":"Explosive PA rate", "value":"+6.3%", "trend":"good", "suffix":"vs base" },
    { "label":"Yds/Play (UK)", "value":"5.7", "trend":"good" },
    { "label":"Havoc Allowed", "value":"42%", "trend":"warn", "suffix":"steady" },
    { "label":"3rd & 6+ defense", "value":"46%", "trend":"bad", "suffix":"conv. allowed" },
    { "label":"Boley", "value":"885 yds • 4 TD", "trend":"good" }
  ]
  </script>

  <!-- Featured -->
  <script type="application/json" id="fallback-spotlight_featured">
  {
    "name":"Cutter Boley","pos":"QB","headshot":"https://a.espncdn.com/i/headshots/college-football/players/full/5141378.png",
    "espn":"https://www.espn.com/college-football/player/_/id/5141378/cutter-boley",
    "last_game":{"opp":"Texas","cmp_att":"31/39","yds":"258","td":"0","int":"1"},
    "season":{"cmp_pct":"64%","yds":"885","td":"4","int":"4"}
  }
  </script>

  <!-- Offense Last -->
  <script type="application/json" id="fallback-spotlight_offense_last">
  [
    {"name":"Cutter Boley","pos":"QB","headshot":"https://a.espncdn.com/i/headshots/college-football/players/full/5141378.png","espn":"https://www.espn.com/college-football/player/_/id/5141378/cutter-boley","last_game":{"opp":"Texas","cmp_att":"31/39","yds":"258","td":"0","int":"1"},"season":{"cmp_pct":"64%","yds":"885","td":"4","int":"4"}},
    {"name":"Seth McGowan","pos":"RB","headshot":"https://a.espncdn.com/i/headshots/college-football/players/full/4686468.png","espn":"https://www.espn.com/college-football/player/_/id/4686468/seth-mcgowan","last_game":{"opp":"Texas","rush":"14","yds":"45","td":"0","rec":"7","rec_yds":"68"},"season":{"car":"93","yds":"476","td":"7","avg":"5.1"}},
    {"name":"Kendrick Law","pos":"WR","headshot":"https://a.espncdn.com/i/headshots/college-football/players/full/4685441.png","espn":"https://www.espn.com/college-football/player/_/id/4685441/kendrick-law","last_game":{"opp":"Texas","rec":"3","yds":"25","td":"0"},"season":{"rec":"22","yds":"199","td":"1","avg":"9.0"}}
  ]
  </script>

  <!-- Offense Season -->
  <script type="application/json" id="fallback-spotlight_offense_season">
  [
    {"name":"Seth McGowan","pos":"RB","headshot":"https://a.espncdn.com/i/headshots/college-football/players/full/4686468.png","espn":"https://www.espn.com/college-football/player/_/id/4686468/seth-mcgowan","season":{"car":"93","yds":"476","td":"7","avg":"5.1"}},
    {"name":"Cutter Boley","pos":"QB","headshot":"https://a.espncdn.com/i/headshots/college-football/players/full/5141378.png","espn":"https://www.espn.com/college-football/player/_/id/5141378/cutter-boley","season":{"cmp_pct":"64%","yds":"885","td":"4","int":"4"}},
    {"name":"Ja'Mori Maclin","pos":"WR","headshot":"https://a.espncdn.com/i/headshots/college-football/players/full/4430270.png","espn":"https://www.espn.com/college-football/player/_/id/4430270/jamori-maclin","season":{"rec":"8","yds":"135","td":"0","avg":"16.9"}}
  ]
  </script>

  <!-- Defense Last -->
  <script type="application/json" id="fallback-spotlight_defense_last">
  [
    {"name":"Alex Afari Jr.","pos":"DB","headshot":"https://a.espncdn.com/i/headshots/college-football/players/full/4819224.png","espn":"https://www.espn.com/college-football/player/_/id/4819224/alex-afari-jr","last_game":{"opp":"Texas","tkl":"7","tfl":"1","pbu":"1"}},
    {"name":"Daveren Rayner","pos":"LB","headshot":"https://a.espncdn.com/i/headshots/college-football/players/full/4430670.png","espn":"https://www.espn.com/college-football/player/_/id/4430670/daveren-rayner","last_game":{"opp":"Texas","tkl":"9","tfl":"1"}},
    {"name":"Jordan Lovett","pos":"DB","headshot":"https://a.espncdn.com/i/headshots/college-football/players/full/4683458.png","espn":"https://www.espn.com/college-football/player/_/id/4683458/jordan-lovett","last_game":{"opp":"Texas","tkl":"6"}}
  ]
  </script>

  <!-- Defense Season -->
  <script type="application/json" id="fallback-spotlight_defense_season">
  [
    {"name":"Alex Afari Jr.","pos":"DB","headshot":"https://a.espncdn.com/i/headshots/college-football/players/full/4819224.png","espn":"https://www.espn.com/college-football/player/_/id/4819224/alex-afari-jr","season":{"tkl":"38","tfl":"4","pbu":"4"}},
    {"name":"Daveren Rayner","pos":"LB","headshot":"https://a.espncdn.com/i/headshots/college-football/players/full/4430670.png","espn":"https://www.espn.com/college-football/player/_/id/4430670/daveren-rayner","season":{"tkl":"42","tfl":"3","sck":"1"}},
    {"name":"DJ Waller Jr.","pos":"DB","headshot":"https://a.espncdn.com/i/headshots/college-football/players/full/5092262.png","espn":"https://www.espn.com/college-football/player/_/id/5092262/dj-waller-jr","season":{"tkl":"21","int":"1","pbu":"3"}}
  ]
  </script>
  <!-- ======== END INLINE FALLBACKS ======== -->

  <!-- JSON loaders + ESPN live wiring -->
  <script>
  (async function(){
    // ----- CONFIG -----
    const TEAM_ID = new URLSearchParams(location.search).get('team') || '96'; // Kentucky default
    const POLL_MS = 30_000;  // refresh live stats every 30s
    const NOIMG = 'data:image/svg+xml;base64,' + btoa('<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48"><rect width="100%" height="100%" fill="#0033a0"/><text x="50%" y="54%" dominant-baseline="middle" text-anchor="middle" font-family="Arial" font-size="12" fill="#fff">UK</text></svg>');

    // ----- HELPERS -----
    const log = (...a) => console.log('[HC-ESPN]', ...a);
    const headshot = (id) => id ? `https://a.espncdn.com/i/headshots/college-football/players/full/${id}.png` : '';

    async function fetchOrFallback(primaryPath, fallbackScriptId){
      const tryPaths = [primaryPath, primaryPath.replace(/^\//,'')];
      for(const p of tryPaths){
        try{
          const r = await fetch(p, {cache:'no-store'});
          if(r.ok){ return await r.json(); }
        }catch(e){}
      }
      const tag = document.getElementById(fallbackScriptId);
      if(tag){ try{ return JSON.parse(tag.textContent); }catch(e){} }
      return null;
    }

    async function j(url){
      const res = await fetch(url, {mode:'cors', cache:'no-store'});
      if(!res.ok) throw new Error(res.status + ' ' + url);
      return res.json();
    }

    function fmtKick(dateStr, networks){
      const d = new Date(dateStr);
      const opts = {weekday:'short', month:'short', day:'numeric', hour:'numeric', minute:'2-digit'};
      const when = isFinite(d) ? d.toLocaleString(undefined, opts) : 'TBA';
      const tv = Array.isArray(networks) && networks.length ? networks[0].shortName || networks[0].name || 'TV TBA' : 'TV TBA';
      return { when, tv };
    }

    function setKickoffUI(teamName, oppName, meta){
      const t = document.getElementById('nextTeamName');
      const o = document.getElementById('nextOpponent');
      const m = document.getElementById('nextMeta');
      if(t) t.textContent = teamName || 'Kentucky';
      if(o) o.textContent = oppName || '[Opponent]';
      if(m) m.innerHTML = `Date • Time • TV: <b>${meta.when}</b> • <b>${meta.tv}</b>`;
    }

    // ----- ESPN EVENT DISCOVERY -----
    async function getTeamEnvelope(teamId){
      try{
        return await j(`https://site.api.espn.com/apis/site/v2/sports/football/college-football/teams/${teamId}`);
      }catch(e){
        log('team envelope failed', e);
        return null;
      }
    }

    function opponentFromComp(comp, teamId){
      const comps = comp?.competitors || [];
      const foe = comps.find(c => String(c.team?.id) !== String(teamId)) || comps[0];
      return foe?.team?.displayName || 'TBA';
    }

    async function eventSummary(eventId){
      return await j(`https://site.api.espn.com/apis/site/v2/sports/football/college-football/summary?event=${eventId}`);
    }

    async function chooseEventForStats(teamEnv){
      const next = teamEnv?.team?.nextEvent?.[0];
      const prev = teamEnv?.team?.previousEvent?.[0];

      // Try next (if live/in-progress)
      if(next?.id){
        try{
          const sum = await eventSummary(next.id);
          const state = sum?.header?.competitions?.[0]?.status?.type?.state; // 'pre' | 'in' | 'post'
          if(state === 'in' || state === 'post'){ return { id: next.id, summary: sum, state }; }
          // 'pre' – we’ll still return it for kickoff panel, but not for box score leaders
          if(prev?.id){
            const sumPrev = await eventSummary(prev.id);
            const statePrev = sumPrev?.header?.competitions?.[0]?.status?.type?.state;
            return { id: prev.id, summary: sumPrev, state: statePrev, usePrevForStats:true, nextEventId: next.id };
          }
          return { id: next.id, summary: sum, state, usePrevForStats:false };
        }catch(e){
          log('next summary failed', e);
        }
      }

      // Fallback to previous
      if(prev?.id){
        try{
          const sumPrev = await eventSummary(prev.id);
          const statePrev = sumPrev?.header?.competitions?.[0]?.status?.type?.state;
          return { id: prev.id, summary: sumPrev, state: statePrev, usePrevForStats:true };
        }catch(e){
          log('prev summary failed', e);
        }
      }

      return null;
    }

    // ----- BOX SCORE PARSING -----
    function pickByLabels(category, wanted, tieBreakerLabel){
      if(!category) return null;
      const labels = category.labels || [];
      const rows = category.athletes || [];

      // Build index map for "wanted" labels
      const idx = {};
      wanted.forEach(lbl => idx[lbl] = labels.indexOf(lbl));

      // Choose numeric column to rank by
      const rankIdx = (tieBreakerLabel && labels.indexOf(tieBreakerLabel)) >= 0
        ? labels.indexOf(tieBreakerLabel)
        : (idx.YDS ?? idx.TOT ?? 1);

      const scrub = (v) => {
        if(v == null) return 0;
        const s = String(v);
        const hit = s.match(/-?\d+(\.\d+)?/);
        return hit ? parseFloat(hit[0]) : 0;
      };

      let leader = null;
      for(const r of rows){
        const y = scrub(r?.stats?.[rankIdx]);
        if(!leader || y > leader._rank) leader = {...r, _rank:y};
      }
      if(!leader) return null;

      const statline = labels
        .map((lbl,i)=>{
          const val = leader.stats?.[i];
          if(val == null) return null;
          // Make common labels nicer
          const pretty = ({
            'CMP-ATT':'CMP/ATT','YDS':'YDS','TD':'TD','INT':'INT','CAR':'CAR',
            'REC':'REC','TFL':'TFL','SCK':'SACKS','SACKS':'SACKS','TOT':'TKL','SOLO':'SOLO','AST':'AST'
          })[lbl] || lbl;
          return `${pretty} ${val}`;
        })
        .filter(Boolean)
        .slice(0,3)
        .join(' • ');

      const a = leader.athlete || {};
      const id = a.id || leader.id;
      const name = a.displayName || leader.displayName || 'Unknown';
      const pos = a.position?.abbreviation || '';
      const espn = a.links?.find(l=>/player/.test(l.href))?.href || (id ? `https://www.espn.com/college-football/player/_/id/${id}` : '#');

      return { name, pos, headshot: headshot(id), espn, last_game: {}, season:{}, _raw:leader, statline };
    }

    function extractOffenseLeaders(sum, teamId){
      const blocks = sum?.boxscore?.players || [];
      const teamBlock = blocks.find(b => String(b.team?.id) === String(teamId)) || blocks[0];
      const cats = {};
      for(const c of (teamBlock?.statistics||[])) cats[c.type] = c;

      const pass = pickByLabels(cats.passing,   ['CMP-ATT','YDS','TD','INT'], 'YDS');
      const rush = pickByLabels(cats.rushing,   ['CAR','YDS','TD'], 'YDS');
      const recv = pickByLabels(cats.receiving, ['REC','YDS','TD'], 'YDS');

      // add short "last_game" text for your row renderer (optional, we also pass .statline)
      if(pass) pass.last_game = { yds: pass._raw?.stats?.[(cats.passing?.labels||[]).indexOf('YDS')] || '' };
      if(rush) rush.last_game = { yds: rush._raw?.stats?.[(cats.rushing?.labels||[]).indexOf('YDS')] || '' };
      if(recv) recv.last_game = { yds: recv._raw?.stats?.[(cats.receiving?.labels||[]).indexOf('YDS')] || '' };

      return [pass,rush,recv].filter(Boolean);
    }

    function extractDefenseLeaders(sum, teamId){
      const blocks = sum?.boxscore?.players || [];
      const teamBlock = blocks.find(b => String(b.team?.id) === String(teamId)) || blocks[0];
      const cats = {};
      for(const c of (teamBlock?.statistics||[])) cats[c.type] = c;

      const def = cats.defensive || cats.defense || null;
      if(!def) return [];

      // Sort all defenders by total tackles (TOT), then SOLO
      const labels = def.labels || [];
      const idxTOT = labels.indexOf('TOT');
      const idxSOLO = labels.indexOf('SOLO');
      const rows = (def.athletes||[]).slice().sort((a,b)=>{
        const A = parseInt(a?.stats?.[idxTOT] || '0');
        const B = parseInt(b?.stats?.[idxTOT] || '0');
        if(B !== A) return B - A;
        const As = parseInt(a?.stats?.[idxSOLO] || '0');
        const Bs = parseInt(b?.stats?.[idxSOLO] || '0');
        return Bs - As;
      }).slice(0,3);

      return rows.map(r=>{
        const a = r.athlete || {};
        const id = a.id || r.id;
        const name = a.displayName || r.displayName || 'Unknown';
        const pos = a.position?.abbreviation || '';
        const espn = id ? `https://www.espn.com/college-football/player/_/id/${id}` : '#';
        // Build a 3-item defensive line if present
        const parts = [];
        const pushIf = (label, pretty) => {
          const i = labels.indexOf(label);
          if(i>=0 && r.stats?.[i]!=null) parts.push(`${pretty} ${r.stats[i]}`);
        };
        pushIf('TOT','TKL'); pushIf('TFL','TFL'); pushIf('SCK','SACKS'); pushIf('SACKS','SACKS'); pushIf('INT','INT');
        const statline = parts.slice(0,3).join(' • ');
        return { name, pos, headshot: headshot(id), espn, last_game:{}, season:{}, statline };
      });
    }

    // ----- UI RENDER (your existing structure) -----
    const wrap = document.getElementById('miniSpotlight');
    const list = document.getElementById('miniList');
    const featuredEl = document.getElementById('miniFeatured');

    function rowHTML(p, featured=false){
      const initials = (p.name||'').split(/\s+/).map(s=>s[0]).slice(0,2).join('').toUpperCase() || 'UK';
      const stat = p.statline || '';
      return `
        <div class="row">
          <img src="${p.headshot||''}" alt="${p.name} headshot"
               onerror="this.replaceWith((()=>{const d=document.createElement('div');d.style.cssText='width:48px;height:48px;border-radius:8px;display:grid;place-items:center;background:#0033a0;color:#fff;font:800 14px/1 system-ui';d.textContent='${initials}';return d;})())">
          <div>
            <div class="who">${p.name} <span class="tiny">• ${p.pos||''}</span></div>
            <div class="stat">${stat} <a href="${p.espn||'#'}" target="_blank" rel="noopener" class="tiny">ESPN ↗</a></div>
          </div>
        </div>`;
    }

    // STATE
    let side = 'offense', span = 'last';
    let LIVE = { offense_last: [], defense_last: [], meta: {} };

    wrap?.querySelectorAll('.chip').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        if(btn.dataset.side){ side = btn.dataset.side; }
        if(btn.dataset.span){ span = btn.dataset.span; }
        wrap.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
        wrap.querySelectorAll(`.chip[data-side="${side}"]`).forEach(c=>c.classList.add('active'));
        wrap.querySelectorAll(`.chip[data-span="${span}"]`).forEach(c=>c.classList.add('active'));
        loadMini();
      });
    });
    wrap?.querySelector(`.chip[data-side="${side}"]`)?.classList.add('active');
    wrap?.querySelector(`.chip[data-span="${span}"]`)?.classList.add('active');

    async function loadMini(){
      // Prefer ESPN live when span === 'last'
      if(span === 'last' && (side === 'offense' || side === 'defense') && LIVE[`${side}_last`]?.length){
        const arr = LIVE[`${side}_last`];
        list.innerHTML = arr.slice(0,3).map(p=>rowHTML(p)).join('');
        return;
      }
      // Otherwise: try /data/*.json then inline fallback
      const file = `/data/spotlight_${side}_${span}.json`;
      const fallbackId = `fallback-spotlight_${side}_${span}`;
      const players = await fetchOrFallback(file, fallbackId);
      if(Array.isArray(players) && players.length){
        list.innerHTML = players.slice(0,3).map(p => rowHTML(p)).join('');
      }else{
        list.innerHTML = '<div class="tiny">No data available.</div>';
      }
    }

    // ----- TICKER LOADER (unchanged) -----
    (async ()=>{
      const items = await fetchOrFallback('/data/ticker.json','fallback-ticker');
      const track = document.getElementById('tickerTrack');
      if(Array.isArray(items) && track){
        track.innerHTML = items.map(it => {
          const trend = it.trend || 'warn';
          const suffix = it.suffix ? ' ' + it.suffix : '';
          return `
            <li>
              <span class="trend-dot ${trend}" aria-hidden="true"></span>
              <span class="label"><strong>${it.label}</strong> <span class="trend-value ${trend}">${it.value}</span>${suffix}</span>
            </li>`;
        }).join('');
      }
    })();

    // ----- LIVE BOOT -----
    async function bootLive(){
      const env = await getTeamEnvelope(TEAM_ID);
      const teamName = env?.team?.displayName || 'Kentucky';

      // Kickoff panel (always use next if present; otherwise previous)
      const nextEvent = env?.team?.nextEvent?.[0] || env?.team?.previousEvent?.[0] || null;
      if(nextEvent){
        const comp = nextEvent.competitions?.[0];
        const opp = comp ? opponentFromComp(comp, TEAM_ID) : 'TBA';
        const networks = comp?.broadcasts || comp?.broadcast || [];
        const meta = fmtKick(nextEvent.date || comp?.date, networks);
        setKickoffUI(teamName, opp, meta);
      }

      // Choose event to pull "Last" leaders from
      const chosen = await chooseEventForStats(env);
      if(!chosen){ loadMini(); return; }

      // If we used next for kickoff but need previous for stats, still fine.
      const sum = chosen.summary;
      const off = extractOffenseLeaders(sum, TEAM_ID);
      const def = extractDefenseLeaders(sum, TEAM_ID);
      LIVE.offense_last = off;
      LIVE.defense_last  = def;

      // Featured = top offensive leader if available; else first available
      const feat = (off && off[0]) || (def && def[0]);
      if(feat && featuredEl){
        featuredEl.innerHTML = rowHTML(feat, true);
        featuredEl.style.display = 'flex';
      }

      // Initial render + polling
      loadMini();
    }

    await bootLive();
    setInterval(bootLive, POLL_MS);

    // footer year
    const y=document.getElementById('year'); if(y) y.textContent=new Date().getFullYear();
  })();
  </script>
</body>
</html>
