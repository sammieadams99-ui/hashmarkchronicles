<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hashmark Chronicles ‚Äî Kentucky Athletics Blog</title>
  <meta name="description" content="Independent Kentucky football analysis with film-room breakdowns, data-driven previews, and postgame reviews. Hoops coverage coming soon." />
  <link rel="canonical" href="https://hashmarkchronicles.online/" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Hashmark Chronicles ‚Äî Kentucky Athletics Blog" />
  <meta property="og:description" content="Independent Kentucky football analysis with film-room breakdowns, data-driven previews, and postgame reviews." />
  <meta property="og:image" content="https://artwork.espncdn.com/events/401752743/16x9/1280x720_20250324202019.png" />
  <meta property="og:url" content="https://hashmarkchronicles.online/" />
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@HashmarkCFB" />
  <meta name="twitter:title" content="Hashmark Chronicles ‚Äî Kentucky Athletics Blog" />
  <meta name="twitter:description" content="Independent Kentucky football analysis with film-room breakdowns, data-driven previews, and postgame reviews." />
  <meta name="twitter:image" content="https://artwork.espncdn.com/events/401752743/16x9/1280x720_20250324202019.png" />

  <!-- Retro font (ticker only) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <!-- Chart.js (you already had it for articles) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --ky-blue:#0033a0; --ink:#0b0d12; --paper:#ffffff; --muted:#eef1f6; --hc-green:#39ff14;
      --accent:#1b75ff; --shadow:0 6px 24px rgba(0,0,0,.12); --radius:18px;
      --good:#16a34a; --bad:#dc2626; --warn:#d97706;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0}
    body{font-family:Georgia,Times,"Times New Roman",serif;color:var(--ink);background:#f7f8fb;line-height:1.6}
    a{color:var(--ky-blue);text-decoration:none} a:hover{color:var(--accent)}

    .bar{background:var(--ink);color:var(--paper);font:500 14px/1.2 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;padding:8px 16px;display:flex;align-items:center;justify-content:center;gap:10px}
    .bar .dot{width:8px;height:8px;border-radius:50%;background:var(--hc-green);display:inline-block}

    header{position:sticky;top:0;z-index:50;backdrop-filter:blur(8px);background:rgba(255,255,255,.85);border-bottom:2px solid var(--muted)}
    .wrap{max-width:1100px;margin:auto;padding:16px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:16px}

    .brand{display:flex;align-items:center;gap:14px}
    .hc-logo{width:56px;height:56px;border-radius:12px;position:relative;overflow:hidden;background:var(--ky-blue);box-shadow:var(--shadow);display:grid;place-items:center}
    .hc-logo span{font:italic 800 28px/1 system-ui,-apple-system,Segoe UI,Arial,sans-serif;color:#fff;letter-spacing:.5px;transform:translateY(3px)}
    .hc-logo::before{content:"";position:absolute;top:8px;left:8px;right:8px;height:5px;border-radius:5px;background:linear-gradient(90deg,transparent 0%,var(--hc-green) 35%,var(--hc-green) 65%,transparent 100%);filter:drop-shadow(0 0 6px rgba(57,255,20,.6));animation:swipe 2.8s ease-in-out infinite;opacity:.95}
    @keyframes swipe{0%{transform:translateX(-120%)}40%{transform:translateX(0)}60%{transform:translateX(0)}100%{transform:translateX(120%)}}
    .brand-title{display:flex;flex-direction:column}
    .brand-title strong{font:800 20px/1.2 "Franklin Gothic Medium","Arial Narrow",Arial,sans-serif;color:var(--ink)}
    .brand-title small{font:600 12px/1.2 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#4a5568;letter-spacing:.5px}

    nav ul{display:flex;gap:18px;list-style:none;margin:0;padding:0}
    nav a{font:600 14px/1 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}

    .chip-x{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid var(--ky-blue);background:#fff;color:var(--ky-blue);font:700 12px/1 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;transition:background .15s,color .15s,border-color .15s}
    .chip-x:hover{background:var(--ky-blue);color:#fff;border-color:var(--ky-blue)}
    .chip-x .x-glyph{font-weight:900;font-size:14px;line-height:1;display:inline-block;transform:translateY(-1px)}

    .ticker{width:100%;background:#fff;color:#0b0d12;border-top:3px solid var(--ky-blue);border-bottom:1px solid var(--muted);overflow:hidden}
    .ticker__track{display:flex;gap:40px;list-style:none;margin:0;padding:6px 0 6px 100%;font-family:'Press Start 2P',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;font-size:11px;line-height:1.1;white-space:nowrap;animation:hc-marquee 28s linear infinite}
    @keyframes hc-marquee{to{transform:translateX(-100%)}}
    .ticker:hover .ticker__track{animation-play-state:paused}
    @media (prefers-reduced-motion:reduce){.ticker__track{animation:none;padding-left:16px}}
    .ticker__track.trend li{display:inline-flex;align-items:baseline;gap:6px}
    .trend-dot{width:7px;height:7px;border-radius:50%}
    .label{color:#0b0d12}
    .trend-value.good{color:#16a34a}.trend-value.bad{color:#dc2626}.trend-value.warn{color:#d97706}
    .trend-dot.good{background:#16a34a}.trend-dot.bad{background:#dc2626}.trend-dot.warn{background:#d97706}

    .hero{max-width:1100px;margin:24px auto;display:grid;grid-template-columns:1.2fr .8fr;gap:24px}
    .card{background:var(--paper);border:1px solid var(--muted);border-radius:var(--radius);box-shadow:var(--shadow)}
    .card .pad{padding:20px}
    .hero .feature img{display:block;width:100%;height:auto;border-top-left-radius:var(--radius);border-top-right-radius:var(--radius)}
    .kicker{font:700 12px/1 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;text-transform:uppercase;letter-spacing:.12em;color:var(--ky-blue)}
    h1,h2,h3{font-family:"Franklin Gothic Medium","Arial Narrow",Arial,sans-serif;color:#0b0d12}
    h1{font-size:32px;margin:8px 0 14px} h2{font-size:22px;margin:0 0 10px} p{margin:0 0 12px}

    .block{padding:16px;border-top:3px solid var(--ky-blue)}
    .stat-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
    .stat{background:#f3f6fb;border:1px solid var(--muted);border-radius:12px;padding:10px}
    .stat b{display:block;font:800 18px/1.1 "Franklin Gothic Medium","Arial Narrow",Arial,sans-serif}
    .stat span{font:600 12px/1.2 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#475569}

    main{max-width:1100px;margin:0 auto 48px;display:grid;grid-template-columns:1fr .38fr;gap:24px}
    article{background:var(--paper);border:1px solid var(--muted);border-radius:var(--radius);box-shadow:var(--shadow)}
    .prose{padding:24px}.prose h2{margin-top:22px}

    /* Article extras kept from your file */
    .article-body h1{font-size:2.2em;border-bottom:2px solid #003087;padding-bottom:.3em;margin-top:.5rem}
    .header-image,.atmosphere-image,.special-teams-image{width:100%;height:auto;margin:1em 0;border-radius:6px;display:block}
    .video-container{position:relative;padding-bottom:56.25%;height:0;overflow:hidden;margin:1em 0;background:#000 url('https://via.placeholder.com/800x450?text=Video+Loading') center/cover}
    .video-container iframe{position:absolute;top:0;left:0;width:100%;height:100%;border:0}
    blockquote.twitter-tweet{margin:1em auto;border-left:4px solid #003087;padding-left:1em}
    .tweet-embed figcaption{color:#444;font-size:.9em;text-align:center;margin-top:.4rem}
    table{width:100%;border-collapse:collapse;margin:1em 0;font-size:.9em}
    th,td{border:1px solid #ddd;padding:.75em;text-align:left}
    th{background:#003087;color:#fff;font-weight:700}
    tr:nth-child(even){background:#f9f9f9}
    .pull-quote{font-size:1.1em;font-style:italic;color:#333;border-left:4px solid #bf5700;padding:.5em 1em;margin:1.5em 0}
    .section-divider{height:2px;background:linear-gradient(to right,#003087,#bf5700);margin:2rem 0}

    /* Spotlight compact rows */
    .mini-spotlight .row{position:relative;display:flex;gap:10px;align-items:center;padding:8px;border:1px solid var(--muted);border-radius:10px;background:#fff;margin:8px 0}
    .mini-spotlight .row:hover{background:#f3f6fb}
    .mini-spotlight img{width:48px;height:48px;border-radius:8px;object-fit:cover;border:1px solid var(--muted)}
    .mini-spotlight .who{font:700 14px/1.2 "Franklin Gothic Medium","Arial Narrow",Arial,sans-serif;color:#0b0d12}
    .mini-spotlight .stat{font:600 12px/1.3 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#475569}
    .mini-spotlight .tiny{font:600 11px/1 system-ui;color:#64748b}
    .mini-spotlight .toggles{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0 8px}
    .mini-spotlight .chip{border:1px solid var(--muted);border-radius:999px;padding:6px 10px;background:#fff;font:700 12px/1 system-ui;cursor:pointer}
    .mini-spotlight .chip.active{background:#0033a0;color:#fff;border-color:#0033a0}

    /* Letter grade pill (right side, earlier style) */
    .grade-pill{
      position:absolute; right:8px; top:8px;
      display:inline-flex; align-items:center; gap:6px;
      padding:4px 8px; border-radius:999px; font:800 12px/1 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      border:1px solid #e2e8f0; background:#f8fafc; color:#111;
    }
    .grade-pill .pct{font-weight:700; opacity:.75}
    .grade-a{background:#ecfdf5;border-color:#a7f3d0;color:#065f46}
    .grade-b{background:#eff6ff;border-color:#bfdbfe;color:#1e40af}
    .grade-c{background:#fff7ed;border-color:#fed7aa;color:#9a3412}
    .grade-d{background:#fef2f2;border-color:#fecaca;color:#7f1d1d}
    .grade-f{background:#fee2e2;border-color:#fecaca;color:#7f1d1d}

    #pulse .feeds{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    @media (max-width:980px){#pulse .feeds{grid-template-columns:1fr}}

    footer{background:var(--ink);color:#c7d2fe;padding:28px 0;margin-top:40px}
    footer .cols{max-width:1100px;margin:auto;display:grid;grid-template-columns:1fr 1fr;gap:18px}
    footer a{color:#c7d2fe}

    @media (max-width:980px){
      .hero,main{grid-template-columns:1fr}
      nav ul{flex-wrap:wrap}
      .article-body h1{font-size:1.8em}
    }
  </style>
</head>
<body>
  <div class="bar"><span class="dot"></span> Kentucky Football ‚Ä¢ Independent film-room analysis & previews ‚Ä¢ HC Hoops returns this winter</div>

  <header>
    <div class="wrap row">
      <div class="brand">
        <div class="hc-logo" aria-label="Hashmark Chronicles logo"><span>HC</span></div>
        <div class="brand-title">
          <strong>Hashmark Chronicles</strong>
          <small>Kentucky Athletics Blog</small>
        </div>
      </div>
      <nav aria-label="Primary">
        <ul>
          <li><a href="#article">Gridiron</a></li>
          <li><a href="#hardtop">Hardtop</a></li>
          <li><a href="#pulse">The Pulse</a></li>
          <li><a href="/posts/library.html">Articles</a></li>
          <li><a href="#about">About</a></li>
          <li>
            <a class="chip-x" href="https://x.com/HashmarkCFB" target="_blank" rel="me noopener" aria-label="Follow @HashmarkCFB on X">
              <span class="x-glyph" aria-hidden="true">ùïè</span><span>@HashmarkCFB</span>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- TICKER -->
  <div class="ticker" aria-label="Season leaders & trending stats">
    <ul class="ticker__track trend" id="tickerTrack">
      <li><span class="trend-dot good"></span><span class="label"><strong>Explosive PA rate</strong> <span class="trend-value good">+6.3%</span> vs base</span></li>
      <li><span class="trend-dot good"></span><span class="label"><strong>Yds/Play (UK)</strong> <span class="trend-value good">5.7</span></span></li>
      <li><span class="trend-dot warn"></span><span class="label"><strong>Havoc Allowed</strong> <span class="trend-value warn">42%</span> steady</span></li>
      <li><span class="trend-dot bad"></span><span class="label"><strong>3rd &amp; 6+ defense</strong> <span class="trend-value bad">46%</span> conv. allowed</span></li>
      <li><span class="trend-dot good"></span><span class="label"><strong>Boley</strong> <span class="trend-value good">885 yds ‚Ä¢ 4 TD</span></span></li>
    </ul>
  </div>

  <!-- HERO -->
  <section class="hero">
    <article class="card feature" itemscope itemtype="https://schema.org/Article">
      <img src="https://artwork.espncdn.com/events/401752743/16x9/1280x720_20250324202019.png" alt="Texas Longhorns vs Kentucky Wildcats ‚Äî ESPN event graphic" />
      <div class="pad">
        <div class="kicker">Game Preview</div>
        <h1 itemprop="headline">Kentucky vs. Texas ‚Äî Oct. 18, 2025</h1>
        <p itemprop="description">Your full preview: atmosphere, QB breakdowns, trench warfare, special teams, and the upset call.</p>
        <p><a href="#article">Read the breakdown ‚Üí</a></p>
      </div>
    </article>

    <aside class="card">
      <div class="block">
        <div class="kicker">Next Kickoff</div>
        <h2><span id="nextTeamName">Kentucky</span> @ <span id="nextOpponent" style="white-space:nowrap">[Opponent]</span></h2>
        <p id="nextMeta">Date ‚Ä¢ Time ‚Ä¢ TV: <b>ESPN</b></p>
        <div class="stat-grid" style="margin-top:10px">
          <div class="stat"><b>5.7</b><span>Yards/Play (UK)</span></div>
          <div class="stat"><b>+0.08</b><span>EPA/Play last 3</span></div>
          <div class="stat"><b>42%</b><span>Havoc Allowed</span></div>
          <div class="stat"><b>58%</b><span>Success Rate (PA)</span></div>
        </div>
      </div>
      <div class="block">
        <div class="kicker">Hashmarks</div>
        <p style="margin:8px 0 12px">Quick-hit trends we‚Äôre tracking.</p>
        <ul>
          <li>RPO usage climbing on 2nd-and-medium.</li>
          <li>Boundary corner blitz ~12% vs heavy sets.</li>
          <li>Field-hash shots: +1.2 EPA/play.</li>
        </ul>
      </div>
    </aside>
  </section>

  <!-- MAIN -->
  <main>
    <article id="article" class="article">
      <div class="prose article-body">
        <img src="https://artwork.espncdn.com/events/401752743/16x9/1280x720_20250324202019.png" alt="Texas Longhorns vs Kentucky Wildcats ‚Äî ESPN event graphic" class="header-image" referrerpolicy="no-referrer">
        <h1>Kentucky vs. Texas Football Preview ‚Äì Oct. 18, 2025</h1>
        <h2>Opening Context</h2>
        <p>‚Ä¶(your original copy continues)‚Ä¶</p>
      </div>
    </article>

    <aside aria-label="Sidebar">
      <div class="card pad mini-spotlight" id="miniSpotlight">
        <div class="kicker">Player Spotlight</div>
        <div id="miniFeatured" class="row" style="display:none"></div>
        <div class="toggles">
          <button class="chip" data-side="offense">Offense</button>
          <button class="chip" data-side="defense">Defense</button>
          <button class="chip" data-span="last">Last</button>
          <button class="chip" data-span="season">Season</button>
        </div>
        <div id="miniList"></div>
        <div class="tiny">Powered by CFBD data with ESPN live updates (falls back if offline).</div>
      </div>

      <div class="card pad">
        <div class="kicker">Newsletter</div>
        <h3>Join the Film Room</h3>
        <p>One email after each game: charts, context, and a clean verdict.</p>
        <form action="#" method="post" onsubmit="alert('Stub ‚Äî wire this to your email provider'); return false;">
          <label for="email" style="display:block;margin-bottom:6px">Email</label>
          <input id="email" name="email" type="email" required placeholder="you@example.com" style="width:100%;padding:12px;border-radius:10px;border:1px solid var(--muted);margin-bottom:10px" />
          <button type="submit" style="background:var(--ky-blue);color:#fff;border:none;padding:10px 14px;border-radius:10px;font-weight:700">Subscribe</button>
        </form>
      </div>

      <div class="card pad" id="about">
        <div class="kicker">About</div>
        <p>Hashmark Chronicles is an independent Kentucky athletics outlet: film-first, data-backed, and unbothered by press-room groupthink. Football now; hoops soon.</p>
      </div>
    </aside>
  </main>

  <section id="hardtop" class="wrap" style="max-width:1100px;margin:0 auto 32px;">
    <div class="card pad">
      <div class="kicker">Hardtop</div>
      <h2>Basketball coverage returns this winter.</h2>
      <p>We‚Äôll post scouting notes, tempo trends, and shooting gravity maps here.</p>
    </div>
  </section>

  <section id="pulse" class="wrap" style="max-width:1100px;margin:0 auto 40px;">
    <div class="card pad">
      <div class="kicker">The Pulse</div>
      <h2 style="margin-top:6px">Live highlights & Kentucky feeds</h2>
      <p style="margin-bottom:12px">Embedded timelines for quick scrolling. Swap handles or add more as needed.</p>
      <div class="feeds">
        <div><a class="twitter-timeline" data-height="500" data-theme="light" data-chrome="noheader nofooter noborders transparent" href="https://twitter.com/UKFootball">Tweets by UKFootball</a></div>
        <div><a class="twitter-timeline" data-height="500" data-theme="light" data-chrome="noheader nofooter noborders transparent" href="https://twitter.com/UKAthletics">Tweets by UKAthletics</a></div>
        <div><a class="twitter-timeline" data-height="500" data-theme="light" data-chrome="noheader nofooter noborders transparent" href="https://twitter.com/KySportsRadio">Tweets by KySportsRadio</a></div>
      </div>
    </div>
  </section>

  <footer>
    <div class="cols">
      <div>
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
          <div class="hc-logo" aria-hidden="true"><span>HC</span></div>
          <div>
            <strong style="display:block;font:800 16px/1.2 'Franklin Gothic Medium','Arial Narrow',Arial,sans-serif;color:#e2e8f0">Hashmark Chronicles</strong>
            <span style="font:600 12px/1.2 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#94a3b8">Kentucky Athletics Blog</span>
          </div>
        </div>
        <small style="color:#aab4d4">¬© <span id="year"></span> HC Media. Not affiliated with the University of Kentucky. Opinions are our own.</small>
      </div>
      <div>
        <div class="kicker" style="color:#c7d2fe">Links</div>
        <p><a href="https://twitter.com/HashmarkCFB" target="_blank" rel="noopener">X / Twitter</a> ‚Ä¢ <a href="#">TikTok</a> ‚Ä¢ <a href="#">YouTube</a></p>
      </div>
    </div>
  </footer>

  <!-- X/Twitter embeds -->
  <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

  <!-- ======== INLINE FALLBACK DATA (used only if ESPN fails) ======== -->
  <script type="application/json" id="fallback-ticker">
  [
    { "label":"Explosive PA rate", "value":"+6.3%", "trend":"good", "suffix":"vs base" },
    { "label":"Yds/Play (UK)", "value":"5.7", "trend":"good" },
    { "label":"Havoc Allowed", "value":"42%", "trend":"warn", "suffix":"steady" },
    { "label":"3rd & 6+ defense", "value":"46%", "trend":"bad", "suffix":"conv. allowed" },
    { "label":"Boley", "value":"885 yds ‚Ä¢ 4 TD", "trend":"good" }
  ]
  </script>

  <!-- Featured + Spotlight fallbacks (same shape you had) -->
  <script type="application/json" id="fallback-spotlight_featured">
  {"name":"Cutter Boley","pos":"QB","headshot":"https://a.espncdn.com/i/headshots/college-football/players/full/5141378.png","espn":"https://www.espn.com/college-football/player/_/id/5141378/cutter-boley","last_game":{"opp":"Texas","cmp_att":"31/39","yds":"258","td":"0","int":"1"},"season":{"cmp_pct":"64%","yds":"885","td":"4","int":"4"}}
  </script>
  <script type="application/json" id="fallback-spotlight_offense_last">
  [
    {"name":"Cutter Boley","pos":"QB","headshot":"https://a.espncdn.com/i/headshots/college-football/players/full/5141378.png","espn":"https://www.espn.com/college-football/player/_/id/5141378/cutter-boley","last_game":{"opp":"Texas","cmp_att":"31/39","yds":"258","td":"0","int":"1"}},
    {"name":"Seth McGowan","pos":"RB","headshot":"https://a.espncdn.com/i/headshots/college-football/players/full/4686468.png","espn":"https://www.espn.com/college-football/player/_/id/4686468/seth-mcgowan","last_game":{"opp":"Texas","rush":"14","yds":"45","td":"0","rec":"7","rec_yds":"68"}},
    {"name":"Kendrick Law","pos":"WR","headshot":"https://a.espncdn.com/i/headshots/college-football/players/full/4685441.png","espn":"https://www.espn.com/college-football/player/_/id/4685441/kendrick-law","last_game":{"opp":"Texas","rec":"3","yds":"25","td":"0"}}
  ]
  </script>
  <script type="application/json" id="fallback-spotlight_offense_season">
  [
    {"name":"Seth McGowan","pos":"RB","headshot":"https://a.espncdn.com/i/headshots/college-football/players/full/4686468.png","espn":"https://www.espn.com/college-football/player/_/id/4686468/seth-mcgowan","season":{"car":"93","yds":"476","td":"7","avg":"5.1"}},
    {"name":"Cutter Boley","pos":"QB","headshot":"https://a.espncdn.com/i/headshots/college-football/players/full/5141378.png","espn":"https://www.espn.com/college-football/player/_/id/5141378/cutter-boley","season":{"cmp_pct":"64%","yds":"885","td":"4","int":"4"}},
    {"name":"Ja'Mori Maclin","pos":"WR","headshot":"https://a.espncdn.com/i/headshots/college-football/players/full/4430270.png","espn":"https://www.espn.com/college-football/player/_/id/4430270/jamori-maclin","season":{"rec":"8","yds":"135","td":"0","avg":"16.9"}}
  ]
  </script>
  <script type="application/json" id="fallback-spotlight_defense_last">
  [
    {"name":"Alex Afari Jr.","pos":"DB","headshot":"https://a.espncdn.com/i/headshots/college-football/players/full/4819224.png","espn":"https://www.espn.com/college-football/player/_/id/4819224/alex-afari-jr","last_game":{"opp":"Texas","tkl":"7","tfl":"1","pbu":"1"}},
    {"name":"Daveren Rayner","pos":"LB","headshot":"https://a.espncdn.com/i/headshots/college-football/players/full/4430670.png","espn":"https://www.espn.com/college-football/player/_/id/4430670/daveren-rayner","last_game":{"opp":"Texas","tkl":"9","tfl":"1"}},
    {"name":"Jordan Lovett","pos":"DB","headshot":"https://a.espncdn.com/i/headshots/college-football/players/full/4683458.png","espn":"https://www.espn.com/college-football/player/_/id/4683458/jordan-lovett","last_game":{"opp":"Texas","tkl":"6"}}
  ]
  </script>
  <script type="application/json" id="fallback-spotlight_defense_season">
  [
    {"name":"Alex Afari Jr.","pos":"DB","headshot":"https://a.espncdn.com/i/headshots/college-football/players/full/4819224.png","espn":"https://www.espn.com/college-football/player/_/id/4819224/alex-afari-jr","season":{"tkl":"38","tfl":"4","pbu":"4"}},
    {"name":"Daveren Rayner","pos":"LB","headshot":"https://a.espncdn.com/i/headshots/college-football/players/full/4430670.png","espn":"https://www.espn.com/college-football/player/_/id/4430670/daveren-rayner","season":{"tkl":"42","tfl":"3","sck":"1"}},
    {"name":"DJ Waller Jr.","pos":"DB","headshot":"https://a.espncdn.com/i/headshots/college-football/players/full/5092262.png","espn":"https://www.espn.com/college-football/player/_/id/5092262/dj-waller-jr","season":{"tkl":"21","int":"1","pbu":"3"}}
  ]
  </script>
  <!-- ======== END INLINE FALLBACKS ======== -->

  <!-- Single inline script. ESPN-first ‚Üí fallback. Adds ranking + letter grades. -->
  <script>
  (function start(run){ if(document.readyState!=='loading'){ run(); } else { document.addEventListener('DOMContentLoaded', run); } })(function(){
  (async function(){
    /* ---------------- CONFIG ---------------- */
    const TEAM_ID = new URLSearchParams(location.search).get('team') || '96'; // UK default
    const POLL_MS = 30_000;
    const DATA_BASE = new URL('.', window.location.href);
    const DATA_CACHE_BUST = new Date().toISOString().slice(0,10).replace(/-/g,'');
    const dataURL = (file) => {
      const url = new URL(`data/${file}`, DATA_BASE);
      url.searchParams.set('v', DATA_CACHE_BUST);
      return url.toString();
    };

    /* ---------------- UTILS ---------------- */
    const log=(...a)=>console.log('[HC]',...a);
    const headshot=id=>id?`https://a.espncdn.com/i/headshots/college-football/players/full/${id}.png`:'';
    const readJSON=id=>{const t=document.getElementById(id); if(!t) return null; try{return JSON.parse(t.textContent);}catch(_){return null;}};
    const j = async url => { const r=await fetch(url,{cache:'no-store',mode:'cors'}); if(!r.ok) throw new Error(r.status+' '+url); return r.json(); };

    const num = v => { const s=String(v??''); const m=s.replace(/,/g,'').match(/-?\d+(\.\d+)?/); return m?parseFloat(m[0]):0; };
    const share = (part,total) => (total && isFinite(total)) ? (part/total) : 0;
    function normalizeRange(val, low, high){
      if(!isFinite(val)) return 0;
      if(high === low) return 0;
      const clamped = Math.min(Math.max(val, low), high);
      return ((clamped - low) / (high - low)) * 100;
    }
    const statPart = (label, val) => {
      const n = Number(val);
      if(!Number.isFinite(n) || Math.abs(n) < 0.5) return null;
      return `${Math.round(n).toLocaleString()} ${label}`;
    };

    function clamp(a,b,x){ return Math.max(a,Math.min(b,x)); }
    function minmaxNormalize(values, x){
      const xs=values.filter(v=>isFinite(v));
      const lo=Math.min(...xs), hi=Math.max(...xs);
      if(!isFinite(lo)||!isFinite(hi)) return 70;
      if(hi===lo) return 70; // all same ‚Üí flat C-
      return ( (x - lo) / (hi - lo) ) * 100;
    }
    function letterFromPct(p){
      const pct=Math.round(clamp(0,100,p));
      const cut=[97,93,90,87,83,80,77,73,70,67,63,60]; // A+..D-
      const lab=['A+','A','A-','B+','B','B-','C+','C','C-','D+','D','D-','F'];
      for(let i=0;i<cut.length;i++){ if(pct>=cut[i]) return {pct,letter:lab[i],band:lab[i].charAt(0).toLowerCase()}; }
      return {pct,letter:'F',band:'f'};
    }
    function gradeBadgeHTML(g){
      return `<span class="grade-pill grade-${g.band}"><span>${g.letter}</span><span class="pct">${g.pct}%</span></span>`;
    }

    /* ---------------- KICKOFF UI ---------------- */
    function opponentName(comp, teamId){
      const foe=(comp?.competitors||[]).find(c=>String(c.team?.id)!==String(teamId))||comp?.competitors?.[0];
      return foe?.team?.displayName || 'TBA';
    }
    function whenTV(dateStr, nets){
      const d=new Date(dateStr); const when=isFinite(d)?d.toLocaleString(undefined,{weekday:'short',month:'short',day:'numeric',hour:'numeric',minute:'2-digit'}):'TBA';
      const tv=(nets&&nets[0])?(nets[0].shortName||nets[0].name||'TV TBA'):'TV TBA';
      return {when,tv};
    }
    function setKick(team, opp, meta){
      const t=document.getElementById('nextTeamName'), o=document.getElementById('nextOpponent'), m=document.getElementById('nextMeta');
      if(t) t.textContent=team||'Kentucky';
      if(o) o.textContent=opp||'[Opponent]';
      if(m) m.innerHTML=`Date ‚Ä¢ Time ‚Ä¢ TV: <b>${meta.when}</b> ‚Ä¢ <b>${meta.tv}</b>`;
    }

    /* ---------------- ESPN FETCHERS ---------------- */
    async function getTeamEnv(teamId){
      try{ return await j(`https://site.api.espn.com/apis/site/v2/sports/football/college-football/teams/${teamId}`); }
      catch(_){ return null; }
    }
    async function getSummary(eventId){
      return await j(`https://site.api.espn.com/apis/site/v2/sports/football/college-football/summary?event=${eventId}`);
    }
    async function getTeamLeaders(teamId){
      try{ return await j(`https://site.api.espn.com/apis/site/v2/sports/football/college-football/teams/${teamId}/leaders`); }
      catch(_){ return null; }
    }
    async function chooseEvent(env){
      const next=env?.team?.nextEvent?.[0]; const prev=env?.team?.previousEvent?.[0];
      async function pack(e){ const sum=await getSummary(e.id); const comp=sum?.header?.competitions?.[0]; const state=comp?.status?.type?.state; return {id:e.id,sum,comp,state}; }
      if(next?.id){ try{const p=await pack(next); if(p.state==='post'||p.state==='in') return p;}catch(_){ } }
      if(prev?.id){ try{return await pack(prev);}catch(_){ } }
      return null;
    }

    /* ---------------- PARSERS: build roster maps ---------------- */
    function ensure(map,id,seed){ if(!map.has(id)) map.set(id,seed()); return map.get(id); }

    function offenseRosterFromBoxscore(sum, teamId){
      const out=new Map();
      const block=(sum?.boxscore?.players||[]).find(b=>String(b.team?.id)===String(teamId));
      if(!block) return out;
      const cats={}; for(const c of (block.statistics||[])) cats[c.type]=c;

      // helpers
      function consume(cat, apply){
        if(!cat) return;
        const L=cat.labels||[], rows=cat.athletes||[];
        rows.forEach(r=>{
          const id=r?.athlete?.id||r?.id; if(!id) return;
          const name=r?.athlete?.displayName||r?.displayName||'Unknown';
          const pos=r?.athlete?.position?.abbreviation||r?.position?.abbreviation||'';
          const p=ensure(out,id,()=>({id,name,pos,link:`https://www.espn.com/college-football/player/_/id/${id}`, head:headshot(id), pass:{}, rush:{}, recv:{}}));
          apply(p,L,r.stats||[]);
        });
      }

      consume(cats.passing,(p,L,S)=>{
        const iCmp=L.indexOf('CMP'), iAtt=L.indexOf('ATT'), iYds=L.indexOf('YDS'), iTD=L.indexOf('TD'), iINT=L.indexOf('INT');
        p.pass={cmp:num(S[iCmp]), att:num(S[iAtt]), yds:num(S[iYds]), td:num(S[iTD]), int:num(S[iINT])};
      });

      consume(cats.rushing,(p,L,S)=>{
        const iCar=L.indexOf('CAR'), iYds=L.indexOf('YDS'), iTD=L.indexOf('TD');
        p.rush={car:num(S[iCar]), yds:num(S[iYds]), td:num(S[iTD])};
      });

      consume(cats.receiving,(p,L,S)=>{
        const iRec=L.indexOf('REC'), iYds=L.indexOf('YDS'), iTD=L.indexOf('TD');
        p.recv={rec:num(S[iRec]), yds:num(S[iYds]), td:num(S[iTD])};
      });

      return out;
    }

    function defenseRosterFromBoxscore(sum, teamId){
      const out=new Map();
      const block=(sum?.boxscore?.players||[]).find(b=>String(b.team?.id)===String(teamId));
      if(!block) return out;
      const def = (block.statistics||[]).find(c=>c.type==='defensive'||c.type==='defense');
      if(!def) return out;
      const L=def.labels||[], rows=def.athletes||[];
      rows.forEach(r=>{
        const id=r?.athlete?.id||r?.id; if(!id) return;
        const name=r?.athlete?.displayName||r?.displayName||'Unknown';
        const pos=r?.athlete?.position?.abbreviation||r?.position?.abbreviation||'';
        const get = (k)=>num(r.stats?.[L.indexOf(k)]);
        out.set(id,{
          id,name,pos,link:`https://www.espn.com/college-football/player/_/id/${id}`, head:headshot(id),
          tot:get('TOT'), solo:get('SOLO'), tfl:get('TFL')||0, sacks:get('SCK')||get('SACKS')||0, ints:get('INT')||0, pbu:get('PD')||get('PBU')||0, ff:get('FF')||get('FORCED')||0
        });
      });
      return out;
    }

    /* ---------------- SCORING MODELS (v2, simple + tunable) ---------------- */
    function offenseScore(p, totals={}){
      const pass=p.pass||{}, rush=p.rush||{}, recv=p.recv||{};
      const totalYards = (totals.passYds||0)+(totals.rushYds||0)+(totals.recvYds||0);
      const playerYards = (pass.yds||0)+(rush.yds||0)+(recv.yds||0);
      const yardShare = share(playerYards, totalYards);
      const yardScore = yardShare * 60;

      const totalTds = (totals.passTd||0)+(totals.rushTd||0)+(totals.recvTd||0);
      const playerTds = (pass.td||0)+(rush.td||0)+(recv.td||0)+(p.totalTd||0);
      const tdScore = share(playerTds, totalTds) * 25;

      const touches = (pass.att||0)+(rush.car||0)+(recv.rec||0);
      let eff = 0;
      if(pass.att>=8){
        const compPct = (pass.cmp||0)/Math.max(1,pass.att||0)*100;
        eff += normalizeRange(compPct, 48, 78) * 0.2;
        eff += normalizeRange((pass.yds||0)/Math.max(1,pass.att||0), 5.5, 11.5) * 0.25;
      }
      if(rush.car>=8){
        eff += normalizeRange((rush.yds||0)/Math.max(1,rush.car||0), 3.8, 7.5) * 0.25;
      }
      if(recv.rec>=5){
        eff += normalizeRange((recv.yds||0)/Math.max(1,recv.rec||0), 9, 21) * 0.25;
      }
      if(touches>=15) eff += 6;

      const explosive = normalizeRange(playerYards, 40, 260) * 0.18;
      const turnoverPenalty = (pass.int||0) * 18;
      const posBoost = /QB/.test(p.pos)?8:(/RB/.test(p.pos)?5:(/WR|TE/.test(p.pos)?4:2));

      const base = yardScore + tdScore + eff + explosive + posBoost;
      return Math.max(0, base - turnoverPenalty);
    }

    function defenseScore(d, totals={}){
      const tackleShare = share(d.tot||0, totals.tot||0) * 35;
      const havoc = (d.tfl||0)+(d.sacks||0)+(d.ints||0)+((d.pbu||0)*0.5)+(d.ff||0);
      const havocShare = share(havoc, totals.havoc||0) * 45;
      const splash = (d.sacks||0)*8 + (d.ints||0)*12 + (d.tfl||0)*6 + (d.pbu||0)*3 + (d.ff||0)*6;
      const volume = normalizeRange(d.tot||0, 3, 12) * 0.2;
      const posBoost = /LB/.test(d.pos)?6:(/DL|DE|NT/.test(d.pos)?5:(/DB|CB|S|FS|SS/.test(d.pos)?4:3));
      const base = tackleShare + havocShare + splash + volume + posBoost;
      return Math.max(0, base);
    }

    function bestStatline(p){
      // choose the loudest category to print
      const passY=p.pass?.yds||0, rushY=p.rush?.yds||0, recvY=p.recv?.yds||0;
      if(passY >= rushY && passY >= recvY){
        const a=p.pass; return `CMP-ATT ${a.cmp||0}/${a.att||0} ‚Ä¢ YDS ${a.yds||0} ‚Ä¢ TD ${a.td||0}${(a.int?(' ‚Ä¢ INT '+a.int):'')}`;
      }
      if(rushY >= recvY){
        const r=p.rush; return `RUSH ${r.car||0} ‚Ä¢ YDS ${r.yds||0} ‚Ä¢ TD ${r.td||0}`;
      }
      const c=p.recv; return `REC ${c.rec||0} ‚Ä¢ YDS ${c.yds||0} ‚Ä¢ TD ${c.td||0}`;
    }

    function defStatline(d){
      const parts=[];
      const add=(lbl,val)=>{ const part=statPart(lbl,val); if(part) parts.push(part); };
      add('TKL', d.tot);
      add('TFL', d.tfl);
      add('SCK', d.sacks);
      add('INT', d.ints);
      add('PBU', d.pbu);
      add('FF', d.ff);
      return parts.slice(0,3).join(' ‚Ä¢ ');
    }

    function seasonOffenseStatline(p){
      const parts=[];
      const add=(lbl,val)=>{ const part=statPart(lbl,val); if(part) parts.push(part); };
      add('PY', p.pass?.yds);
      add('PTD', p.pass?.td);
      add('RY', p.rush?.yds);
      add('RTD', p.rush?.td);
      add('RecY', p.recv?.yds);
      add('RecTD', p.recv?.td);
      add('REC', p.recv?.rec);
      if(parts.length<3) add('TD', p.totalTd);
      if(parts.length<3 && p.extras){
        for(const extra of p.extras){ if(extra){ parts.push(extra); if(parts.length>=3) break; } }
      }
      return parts.slice(0,3).join(' ‚Ä¢ ');
    }

    function seasonDefenseStatline(p){
      const parts=[];
      const add=(lbl,val)=>{ const part=statPart(lbl,val); if(part) parts.push(part); };
      add('TKL', p.tot);
      add('TFL', p.tfl);
      add('SCK', p.sacks);
      add('INT', p.ints);
      add('PBU', p.pbu);
      add('FF', p.ff);
      if(parts.length<3 && p.extras){
        for(const extra of p.extras){ if(extra){ parts.push(extra); if(parts.length>=3) break; } }
      }
      return parts.slice(0,3).join(' ‚Ä¢ ');
    }

    function seasonLeadersFromESPN(raw){
      const groups = Array.isArray(raw?.leaders) ? raw.leaders : (Array.isArray(raw?.teamLeaders) ? raw.teamLeaders : []);
      if(!groups.length) return { offense:[], defense:[], featured:null };

      const offenseMap=new Map();
      const defenseMap=new Map();

      function claim(map, id, seed){ if(!map.has(id)) map.set(id, seed()); return map.get(id); }
      function baseFrom(entry){
        const id=entry?.athlete?.id||entry?.id; if(!id) return null;
        const name=entry?.athlete?.displayName||entry?.displayName||'Unknown';
        const pos=entry?.athlete?.position?.abbreviation||entry?.position?.abbreviation||'';
        return {
          id,
          name,
          pos,
          link:`https://www.espn.com/college-football/player/_/id/${id}`,
          head:headshot(id),
          pass:{}, rush:{}, recv:{},
          tot:0, solo:0, tfl:0, sacks:0, ints:0, pbu:0, ff:0,
          totalTd:0,
          extras:new Set()
        };
      }

      groups.forEach(group=>{
        const label=String(group?.name||group?.displayName||group?.shortDisplayName||'');
        const lower=label.toLowerCase();
        const bucket = /tackle|sack|interception|defen|pass break|forced fumble|pbu/.test(lower) ? 'defense' : 'offense';
        (group?.leaders||[]).forEach(entry=>{
          const base=baseFrom(entry); if(!base) return;
          const map=bucket==='defense'?defenseMap:offenseMap;
          const p=claim(map, base.id, ()=>base);
          const val=num(entry?.value ?? entry?.statValue ?? entry?.amount ?? entry?.yards ?? entry?.totals ?? 0);
          const disp=entry?.displayValue || entry?.display || entry?.shortDisplayName || '';
          if(disp) p.extras.add(disp);
          if(bucket==='offense'){
            const nameLower=lower;
            if(nameLower.includes('pass') && nameLower.includes('yard')) p.pass.yds=Math.max(p.pass.yds||0,val);
            if(nameLower.includes('pass') && nameLower.includes('touch')) p.pass.td=Math.max(p.pass.td||0,val);
            if(nameLower.includes('pass') && (nameLower.includes('comp')||nameLower.includes('completion'))) p.pass.cmp=Math.max(p.pass.cmp||0,val);
            if(nameLower.includes('pass') && nameLower.includes('att')) p.pass.att=Math.max(p.pass.att||0,val);
            if(nameLower.includes('rush') && nameLower.includes('yard')) p.rush.yds=Math.max(p.rush.yds||0,val);
            if(nameLower.includes('rush') && nameLower.includes('touch')) p.rush.td=Math.max(p.rush.td||0,val);
            if(nameLower.includes('rush') && (nameLower.includes('att')||nameLower.includes('carry'))) p.rush.car=Math.max(p.rush.car||0,val);
            if(nameLower.includes('receiv') && nameLower.includes('yard')) p.recv.yds=Math.max(p.recv.yds||0,val);
            if(nameLower.includes('receiv') && nameLower.includes('touch')) p.recv.td=Math.max(p.recv.td||0,val);
            if(nameLower.includes('receiv') && (nameLower.includes('rec')||nameLower.includes('catch'))) p.recv.rec=Math.max(p.recv.rec||0,val);
            if(nameLower.includes('total') && nameLower.includes('touch')) p.totalTd=Math.max(p.totalTd||0,val);
          }else{
            const nameLower=lower;
            if(nameLower.includes('total') && nameLower.includes('tackle')) p.tot=Math.max(p.tot||0,val);
            if(nameLower.includes('solo') && nameLower.includes('tackle')) p.solo=Math.max(p.solo||0,val);
            if(nameLower.includes('sack')) p.sacks=Math.max(p.sacks||0,val);
            if(nameLower.includes('loss')||nameLower.includes('tfl')) p.tfl=Math.max(p.tfl||0,val);
            if(nameLower.includes('interception')||/\bint\b/.test(nameLower)) p.ints=Math.max(p.ints||0,val);
            if((nameLower.includes('pass')&&nameLower.includes('defend'))||nameLower.includes('break up')||nameLower.includes('pbu')) p.pbu=Math.max(p.pbu||0,val);
            if(nameLower.includes('forced') && nameLower.includes('fumble')) p.ff=Math.max(p.ff||0,val);
          }
        });
      });

      const offenseRaw=[...offenseMap.values()];
      const defenseRaw=[...defenseMap.values()];

      const offTotals=offenseRaw.reduce((acc,p)=>({
        passYds:acc.passYds+(p.pass?.yds||0),
        rushYds:acc.rushYds+(p.rush?.yds||0),
        recvYds:acc.recvYds+(p.recv?.yds||0),
        passTd:acc.passTd+(p.pass?.td||0),
        rushTd:acc.rushTd+(p.rush?.td||0),
        recvTd:acc.recvTd+(p.recv?.td||0)
      }),{passYds:0,rushYds:0,recvYds:0,passTd:0,rushTd:0,recvTd:0});
      const defTotals=defenseRaw.reduce((acc,p)=>({
        tot:acc.tot+(p.tot||0),
        havoc:acc.havoc+((p.tfl||0)+(p.sacks||0)+(p.ints||0)+((p.pbu||0)*0.5)+(p.ff||0))
      }),{tot:0,havoc:0});

      const offScores=offenseRaw.map(p=>offenseScore(p, offTotals));
      const offPct=offScores.map(s=>minmaxNormalize(offScores,s));
      const offense=offenseRaw.map((p,i)=>({
        name:p.name,
        pos:p.pos,
        headshot:p.head,
        espn:p.link,
        statline:seasonOffenseStatline(p),
        grade:letterFromPct(offPct[i])
      })).sort((a,b)=>(b.grade?.pct||0)-(a.grade?.pct||0)).slice(0,3);

      const defScores=defenseRaw.map(p=>defenseScore(p, defTotals));
      const defPct=defScores.map(s=>minmaxNormalize(defScores,s));
      const defense=defenseRaw.map((p,i)=>({
        name:p.name,
        pos:p.pos,
        headshot:p.head,
        espn:p.link,
        statline:seasonDefenseStatline(p),
        grade:letterFromPct(defPct[i])
      })).sort((a,b)=>(b.grade?.pct||0)-(a.grade?.pct||0)).slice(0,3);

      const featured = offense[0] || defense[0] || null;
      return { offense, defense, featured };
    }

    /* ---------------- RENDER ---------------- */
    const wrap=document.getElementById('miniSpotlight');
    const list=document.getElementById('miniList');
    const featuredEl=document.getElementById('miniFeatured');

    function rowHTML(p){
      const initials=(p.name||'').split(/\s+/).map(s=>s[0]).slice(0,2).join('').toUpperCase()||'UK';
      const gradeObj = (()=>{
        if(p.grade && p.grade.letter && p.grade.pct!=null && p.grade.band){
          return p.grade;
        }
        if(p.grade_letter && p.grade_pct!=null){
          const pct=Math.round(Number(p.grade_pct));
          const letter=String(p.grade_letter).toUpperCase();
          const band=(letter||'F').charAt(0).toLowerCase();
          return { letter, pct, band };
        }
        if(p.gradePct!=null){
          return letterFromPct(Number(p.gradePct));
        }
        return null;
      })();
      return `
        <div class="row">
          <img src="${p.headshot||p.head||''}" alt="${p.name} headshot"
               onerror="this.replaceWith((()=>{const d=document.createElement('div');d.style.cssText='width:48px;height:48px;border-radius:8px;display:grid;place-items:center;background:#0033a0;color:#fff;font:800 14px/1 system-ui';d.textContent='${initials}';return d;})())">
          <div>
            <div class="who">${p.name} <span class="tiny">‚Ä¢ ${p.pos||''}</span></div>
            <div class="stat">${p.statline||''} <a href="${p.espn||p.link||'#'}" target="_blank" rel="noopener" class="tiny">ESPN ‚Üó</a></div>
          </div>
          ${gradeObj ? gradeBadgeHTML(gradeObj) : ''}
        </div>`;
    }
    function renderList(arr){ list.innerHTML = (arr&&arr.length)?arr.slice(0,3).map(rowHTML).join(''):'<div class="tiny">No data available.</div>'; }

    /* ---------------- STATE + TOGGLES ---------------- */
    let side='offense', span='last';
    let LIVE={
      offense_last:[],
      defense_last:[],
      offense_season:[],
      defense_season:[]
    };

    async function tryLoadBuiltData(){
      async function grab(path){
        try{
          const r = await fetch(path, { cache:'no-store' });
          if(!r.ok) return null;
          return await r.json();
        }catch(_){ return null; }
      }
      try{
        const [offLast, defLast, offSeason, defSeason, feat] = await Promise.all([
          grab('/data/spotlight_offense_last.json'),
          grab('/data/spotlight_defense_last.json'),
          grab('/data/spotlight_offense_season.json'),
          grab('/data/spotlight_defense_season.json'),
          grab('/data/spotlight_featured.json')
        ]);

        if(Array.isArray(offLast) && offLast.length){
          const norm = offLast.map(e=>normalizeEntry(e,'last')).filter(Boolean);
          if(norm.length){
            LIVE.offense_last = norm;
            if(span==='last' && side==='offense') loadMini();
          }
        }
        if(Array.isArray(defLast) && defLast.length){
          const norm = defLast.map(e=>normalizeEntry(e,'last')).filter(Boolean);
          if(norm.length){
            LIVE.defense_last = norm;
            if(span==='last' && side==='defense') loadMini();
          }
        }
        if(Array.isArray(offSeason) && offSeason.length){
          const norm = offSeason.map(e=>normalizeEntry(e,'season')).filter(Boolean);
          if(norm.length){
            LIVE.offense_season = norm;
            if(span==='season' && side==='offense') loadMini();
          }
        }
        if(Array.isArray(defSeason) && defSeason.length){
          const norm = defSeason.map(e=>normalizeEntry(e,'season')).filter(Boolean);
          if(norm.length){
            LIVE.defense_season = norm;
            if(span==='season' && side==='defense') loadMini();
          }
        }
        if(feat && typeof feat === 'object' && feat.name){
          const normalized = normalizeEntry(feat,'last') || feat;
          if(featuredEl){
            featuredEl.innerHTML = rowHTML(normalized);
            featuredEl.style.display = 'flex';
          }
        }
      }catch(err){
        console.warn('[HC] built data load failed', err);
      }
    }

    const LABEL_MAP={
      'cmp_att':'CMP-ATT','cmpatt':'CMP-ATT','cmp':'CMP','att':'ATT','cmp_pct':'CMP%',
      'yds':'YDS','yards':'YDS','passingyards':'PY','passing_yards':'PY','passingtds':'PTD','passing_tds':'PTD',
      'rushingyards':'RY','rushing_yards':'RY','rushingtds':'RTD','rushing_tds':'RTD','receivingyards':'RecY','receiving_yards':'RecY',
      'receivingtds':'RecTD','receiving_tds':'RecTD','rec':'REC','rush':'RUSH','car':'CAR','td':'TD','int':'INT','ints':'INT',
      'tackles':'TKL','tkl':'TKL','tfl':'TFL','sacks':'SCK','sck':'SCK','pbu':'PBU','passesdefended':'PD','forcedfumbles':'FF','ff':'FF',
      'avg':'AVG'
    };
    const IGNORE_LABELS=new Set(['opp','opponent','team','name','week','game']);

    function prettifyLabel(key){
      if(!key) return '';
      const lower=String(key).toLowerCase();
      if(LABEL_MAP[lower]) return LABEL_MAP[lower];
      return String(key).toUpperCase().replace(/[_\s]+/g,' ');
    }

    function formatStatPair(label, value){
      if(value==null||value==='') return null;
      if(IGNORE_LABELS.has(String(label).toLowerCase())) return null;
      const friendly=prettifyLabel(label);
      if(!friendly) return null;
      const raw=String(value).trim();
      if(!raw) return null;
      if(friendly==='CMP-ATT') return `${friendly} ${raw}`;
      const numeric=Number(raw.replace(/,/g,''));
      if(Number.isFinite(numeric) && /^-?\d*(\.\d+)?$/.test(raw.replace(/,/g,''))){
        const digits=(Math.abs(numeric)<10 && !Number.isInteger(numeric))?1:0;
        const display=numeric.toLocaleString(undefined,{maximumFractionDigits:digits});
        return `${display} ${friendly}`;
      }
      if(/^\s*-?\d/.test(raw)) return `${raw} ${friendly}`;
      return `${friendly} ${raw}`;
    }

    function statlineFromEntry(entry, spanHint='last'){
      if(!entry) return '';
      if(entry.statline) return entry.statline;
      const key = spanHint==='season' ? 'season' : 'last_game';
      const raw = entry[key] ?? entry.stats ?? entry.line ?? null;
      if(typeof raw === 'string') return raw;
      const parts=[];
      if(raw && typeof raw === 'object' && !Array.isArray(raw)){
        for(const [label,val] of Object.entries(raw)){
          const part=formatStatPair(label,val);
          if(part) parts.push(part);
          if(parts.length>=3) break;
        }
      }
      if(Array.isArray(raw)){
        for(const chunk of raw){
          if(typeof chunk === 'string' && chunk.trim()){
            parts.push(chunk.trim());
          }else if(chunk && typeof chunk === 'object'){
            const part=formatStatPair(chunk.label||chunk.name, chunk.value??chunk.stat);
            if(part) parts.push(part);
          }
          if(parts.length>=3) break;
        }
      }
      if(!parts.length && entry.summary) parts.push(String(entry.summary));
      return parts.join(' ‚Ä¢ ');
    }

    function normalizeEntry(entry, spanHint='last'){
      if(!entry) return null;
      const name=entry.name||entry.player||'';
      if(!name) return null;
      const pos=entry.pos||entry.position||entry.position_group||'';
      const headshot=entry.headshot||entry.head||'';
      const espn=entry.espn||entry.url||entry.link||'#';
      const statline=statlineFromEntry(entry, spanHint)||'‚Äî';
      let grade=null;
      if(entry.grade && entry.grade.letter && entry.grade.band){
        grade=entry.grade;
      }else if(Number.isFinite(entry.gradePct)){
        grade=letterFromPct(entry.gradePct);
      }else if(Number.isFinite(entry.grade_pct)){
        grade=letterFromPct(entry.grade_pct);
      }
      return { name, pos, headshot, espn, statline, grade };
    }

    wrap?.querySelectorAll('.chip').forEach(btn=>{
      btn.addEventListener('click',()=>{
        if(btn.dataset.side) side=btn.dataset.side;
        if(btn.dataset.span) span=btn.dataset.span;
        wrap.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
        wrap.querySelectorAll(`.chip[data-side="${side}"]`).forEach(c=>c.classList.add('active'));
        wrap.querySelectorAll(`.chip[data-span="${span}"]`).forEach(c=>c.classList.add('active'));
        loadMini();
      });
    });
    wrap?.querySelector(`.chip[data-side="${side}"]`)?.classList.add('active');
    wrap?.querySelector(`.chip[data-span="${span}"]`)?.classList.add('active');

    /* ---------------- TICKER (inline) ---------------- */
    function renderTicker(payload){
      const track=document.getElementById('tickerTrack');
      if(!track) return;
      const items=Array.isArray(payload?.items)?payload.items:(Array.isArray(payload)?payload:[]);
      if(!items.length) return;
      track.innerHTML=items.map(it=>{
        const trend=it.trend||'warn'; const suffix=it.suffix?(' '+it.suffix):'';
        return `<li><span class="trend-dot ${trend}" aria-hidden="true"></span><span class="label"><strong>${it.label}</strong> <span class="trend-value ${trend}">${it.value}</span>${suffix}</span></li>`;
      }).join('');
    }
    (function(){
      const fallback=readJSON('fallback-ticker');
      if(fallback) renderTicker(fallback);
    })();

    /* ---------------- Draw inline immediately ---------------- */
    (function drawInlineFirst(){
      const feat=readJSON('fallback-spotlight_featured');
      const normalized=normalizeEntry(feat, feat?.season && !feat?.last_game ? 'season' : 'last');
      if(normalized&&featuredEl){
        if(!normalized.grade && feat) normalized.grade=estimateInlineGrade(feat);
        featuredEl.innerHTML=rowHTML(normalized);
        featuredEl.style.display='flex';
      }
      loadMini(); // uses inline until LIVE lands
    })();

    function estimateInlineGrade(p){
      // Gentle heuristic so fallbacks don't all look the same
      const src=p.last_game||p.season||{};
      const y=num(src.yds||src.rec_yds||0), td=num(src.td||src.rec_td||0), ints=num(src.int||0);
      const rec=num(src.rec||0), rush=num(src.rush||0);
      const base = 55 + y*0.05 + td*6 + rec*0.6 + rush*0.4 - ints*8;
      return letterFromPct(clamp(40,95,base));
    }

    function loadMini(){
      const key = `${side}_${span}`;
      const arr = LIVE[key];
      if(Array.isArray(arr)&&arr.length){ renderList(arr); return; }
      const inline = readJSON(`fallback-spotlight_${side}_${span}`) || [];
      const adapt = inline.map(p=>{
        const row=normalizeEntry(p, span);
        if(!row) return null;
        if((!row.grade||!row.grade.letter) && p) row.grade=estimateInlineGrade(p);
        if(!row.statline || row.statline==='‚Äî') row.statline=statlineFromEntry(p, span)||row.statline;
        return row;
      }).filter(Boolean);
      renderList(adapt);
    }

    const CACHE_BUST=new Date().toISOString().slice(0,10).replace(/-/g,'');
    async function fetchLocal(path){
      try{
        const res=await fetch(`${path}?v=${CACHE_BUST}`,{cache:'no-store'});
        if(!res.ok) throw new Error(res.status);
        return await res.json();
      }catch(err){
        log('static fetch failed', path, err?.message||err);
    const CFBD_FILES = {
      offense_last: './data/spotlight_offense_last.json',
      defense_last: './data/spotlight_defense_last.json',
      offense_season: './data/spotlight_offense_season.json',
      defense_season: './data/spotlight_defense_season.json',
      featured: './data/spotlight_featured.json'
    };

    async function fetchCFBD(path){
      try{
        const res=await fetch(path,{cache:'no-store'});
        if(!res.ok) throw new Error(String(res.status));
        return await res.json();
      }catch(err){
        log('CFBD spotlight fetch failed', path, err.message||err);
        return null;
      }
    }

    async function hydrateFromStatic(){
      const [tickerData, featuredData, oLast, dLast, oSeason, dSeason] = await Promise.all([
        fetchLocal('data/ticker.json'),
        fetchLocal('data/spotlight_featured.json'),
        fetchLocal('data/spotlight_offense_last.json'),
        fetchLocal('data/spotlight_defense_last.json'),
        fetchLocal('data/spotlight_offense_season.json'),
        fetchLocal('data/spotlight_defense_season.json')
      ]);
      if(tickerData) renderTicker(tickerData);
      const updated=[];
      const assign=(key, rows, spanHint)=>{
        if(Array.isArray(rows) && rows.length){
          const norm=rows.map(r=>normalizeEntry(r, spanHint)).filter(Boolean);
          if(norm.length){
            LIVE[key]=norm;
            updated.push(key);
          }
        }
      };
      assign('offense_last', oLast, 'last');
      assign('defense_last', dLast, 'last');
      assign('offense_season', oSeason, 'season');
      assign('defense_season', dSeason, 'season');
      if(updated.includes(`${side}_${span}`)) loadMini();
      if(featuredData){
        const normalized=normalizeEntry(featuredData, featuredData?.span || (featuredData?.season && !featuredData?.last_game ? 'season' : 'last'));
        if(normalized){
          if(!normalized.grade) normalized.grade=estimateInlineGrade(featuredData);
          if(featuredEl){
            featuredEl.innerHTML=rowHTML(normalized);
            featuredEl.style.display='flex';
          }
        }
      }
    function objectStatline(obj){
      if(!obj) return '';
      return Object.entries(obj).slice(0,3).map(([k,v])=>`${String(k).toUpperCase().replace('_','-')} ${v}`).join(' ‚Ä¢ ');
    }

    function adaptCFBDEntry(entry){
      if(!entry) return null;
      const statline = entry.statline
        || entry.lastSummary
        || entry.seasonSummary
        || (typeof entry.last_game === 'string' ? entry.last_game : objectStatline(entry.last_game))
        || (typeof entry.season === 'string' ? entry.season : objectStatline(entry.season))
        || '';
      let grade = (entry.grade && typeof entry.grade === 'object') ? entry.grade : null;
      if(!grade && (entry.last_game || entry.season)){
        try{ grade = estimateInlineGrade(entry); }catch(_){ grade=null; }
      }
      const out = {
        name: entry.name,
        pos: entry.pos || '',
        headshot: entry.headshot || entry.head || '',
        espn: entry.espn || entry.link || '#',
        statline,
        grade,
        source: entry.source || 'cfbd'
      };
      if(entry.details) out.details = entry.details;
      if(entry.score != null) out.score = entry.score;
      return out;
    }

    async function loadCFBDSpotlight(){
      const [oLast,dLast,oSeason,dSeason,feat] = await Promise.all([
        fetchCFBD(CFBD_FILES.offense_last),
        fetchCFBD(CFBD_FILES.defense_last),
        fetchCFBD(CFBD_FILES.offense_season),
        fetchCFBD(CFBD_FILES.defense_season),
        fetchCFBD(CFBD_FILES.featured)
      ]);

      let touched=false;
      if(Array.isArray(oLast) && oLast.length){
        LIVE.offense_last = oLast.map(adaptCFBDEntry).filter(Boolean);
        touched = true;
      }
      if(Array.isArray(dLast) && dLast.length){
        LIVE.defense_last = dLast.map(adaptCFBDEntry).filter(Boolean);
        touched = true;
      }
      if(Array.isArray(oSeason) && oSeason.length){
        LIVE.offense_season = oSeason.map(adaptCFBDEntry).filter(Boolean);
        touched = true;
      }
      if(Array.isArray(dSeason) && dSeason.length){
        LIVE.defense_season = dSeason.map(adaptCFBDEntry).filter(Boolean);
        touched = true;
      }
      if(feat && feat.name){
        const adapted = adaptCFBDEntry(feat);
        if(adapted && featuredEl && adapted.statline && adapted.statline.replace(/[\s‚Ä¢.-]/g,'').length){
          featuredEl.innerHTML=rowHTML(adapted);
          featuredEl.style.display='flex';
        }
        touched = true;
      }
      if(touched) loadMini();
    }

    /* ---------------- ESPN boot: rank + grades ---------------- */
    async function bootLive(){
      const env=await getTeamEnv(TEAM_ID);
      if(env){
        const teamName=env?.team?.displayName||'Kentucky';
        const nxt=env?.team?.nextEvent?.[0] || env?.team?.previousEvent?.[0];
        if(nxt){
          const comp=nxt.competitions?.[0];
          const meta=whenTV(nxt.date || comp?.date, comp?.broadcasts || comp?.broadcast || []);
          setKick(teamName, opponentName(comp,TEAM_ID), meta);
        }
      }
      const pick=await chooseEvent(env);
      if(!pick){ log('no event, stay inline'); return; }

      // OFFENSE: build roster ‚Üí score ‚Üí normalize ‚Üí rank
      const oMap = offenseRosterFromBoxscore(pick.sum, TEAM_ID);
      let oArr = Array.from(oMap.values());
      if(!oArr.length){
        // fallback to leaders if boxscore not present
        const comp=pick.sum?.header?.competitions?.[0];
        const me=(comp?.competitors||[]).find(c=>String(c.team?.id)===String(TEAM_ID));
        const groups=me?.leaders||pick.sum?.leaders||[];
        function leader(keys){
          const g=(groups||[]).find(x=>{
            const n=(x?.name||x?.shortDisplayName||x?.displayName||'').toLowerCase();
            return keys.some(k=>n.includes(k));
          });
          const a=g?.leaders?.[0]; if(!a) return null;
          return {id:a?.athlete?.id||a?.id, name:a?.athlete?.displayName||a?.displayName, pos:a?.athlete?.position?.abbreviation||'', link:`https://www.espn.com/college-football/player/_/id/${a?.athlete?.id||a?.id}`, head:headshot(a?.athlete?.id||a?.id), pass:{},rush:{},recv:{}, _display:a.displayValue||String(a.value||'')};
        }
        const P=leader(['pass','qb','cmp']), R=leader(['rush','rb','car']), W=leader(['receiv','wr','rec']);
        oArr=[P,R,W].filter(Boolean).map(x=>({...x, statline:x._display}));
      }else{
        // enrich with scores & statlines
        const totals=oArr.reduce((acc,p)=>({
          passYds:acc.passYds+(p.pass?.yds||0),
          rushYds:acc.rushYds+(p.rush?.yds||0),
          recvYds:acc.recvYds+(p.recv?.yds||0),
          passTd:acc.passTd+(p.pass?.td||0),
          rushTd:acc.rushTd+(p.rush?.td||0),
          recvTd:acc.recvTd+(p.recv?.td||0)
        }),{passYds:0,rushYds:0,recvYds:0,passTd:0,rushTd:0,recvTd:0});
        const scores = oArr.map(p=>offenseScore(p, totals));
        oArr = oArr.map((p,i)=>({ ...p, _score:scores[i], statline:bestStatline(p) }));
        const pct = scores.map(s=>minmaxNormalize(scores,s));
        oArr = oArr.map((p,i)=>({ ...p, grade:letterFromPct(pct[i]) }));
        oArr.sort((a,b)=> (b.grade?.pct||0) - (a.grade?.pct||0));
        oArr = oArr.map(p=>({ name:p.name,pos:p.pos, headshot:p.head, espn:p.link, statline:p.statline, grade:p.grade }));
      }

      // DEFENSE: build roster ‚Üí score ‚Üí normalize ‚Üí rank
      const dMap = defenseRosterFromBoxscore(pick.sum, TEAM_ID);
      let dArr = Array.from(dMap.values());
      if(!dArr.length){
        // fallback: tackles leader only
        const comp=pick.sum?.header?.competitions?.[0];
        const me=(comp?.competitors||[]).find(c=>String(c.team?.id)===String(TEAM_ID));
        const groups=me?.leaders||pick.sum?.leaders||[];
        const t=(groups||[]).find(x=>String(x?.name||'').toLowerCase().includes('tackle'));
        const L=t?.leaders?.[0];
        if(L){
          dArr=[{name:L.athlete?.displayName||L.displayName,pos:L.athlete?.position?.abbreviation||'', headshot:headshot(L.athlete?.id||L.id), espn:`https://www.espn.com/college-football/player/_/id/${L.athlete?.id||L.id}`, statline:L.displayValue||'', grade:letterFromPct(78)}];
        }
      }else{
        const totals=dArr.reduce((acc,p)=>({
          tot:acc.tot+(p.tot||0),
          havoc:acc.havoc+((p.tfl||0)+(p.sacks||0)+(p.ints||0)+((p.pbu||0)*0.5)+(p.ff||0))
        }),{tot:0,havoc:0});
        const scores = dArr.map(p=>defenseScore(p, totals));
        const pct = scores.map(s=>minmaxNormalize(scores,s));
        dArr = dArr.map((d,i)=>({ ...d, statline:defStatline(d), grade:letterFromPct(pct[i]) }));
        dArr.sort((a,b)=> (b.grade?.pct||0) - (a.grade?.pct||0));
        dArr = dArr.map(p=>({ name:p.name,pos:p.pos, headshot:p.head, espn:p.link, statline:p.statline, grade:p.grade }));
      }

      // Publish
      LIVE.offense_last = oArr;
      LIVE.defense_last = dArr;

      // Featured = best available
      const feature = (oArr[0]||dArr[0]);
      if(feature && featuredEl){ featuredEl.innerHTML=rowHTML(feature); featuredEl.style.display='flex'; }

      if(span==='last') loadMini();

      const leaderData = await getTeamLeaders(TEAM_ID);
      if(leaderData){
        const seasonPack = seasonLeadersFromESPN(leaderData);
        if(seasonPack.offense.length){
          LIVE.offense_season = seasonPack.offense;
          if(span==='season' && side==='offense') loadMini();
        }
        if(seasonPack.defense.length){
          LIVE.defense_season = seasonPack.defense;
          if(span==='season' && side==='defense') loadMini();
        }
        if(!feature && seasonPack.featured && featuredEl){
          featuredEl.innerHTML=rowHTML(seasonPack.featured);
          featuredEl.style.display='flex';
        }
      }
    }

    // first draw + poll
    await hydrateFromStatic();
    await tryLoadBuiltData();
    await loadCFBDSpotlight();
    await bootLive();
    setInterval(bootLive, POLL_MS);

    // footer year
    const y=document.getElementById('year'); if(y) y.textContent=new Date().getFullYear();
  })();
  });
  </script>
</body>
</html>
